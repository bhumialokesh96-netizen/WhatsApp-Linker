<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Multi-Device Management Dashboard</title>
    <style>
        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333; overflow-x: hidden;
        }
        
        .sidebar {
            position: fixed; left: 0; top: 0; width: 280px; height: 100vh;
            background: linear-gradient(180deg, #1e293b 0%, #334155 100%);
            color: white; padding: 20px 0; z-index: 1000;
            box-shadow: 4px 0 20px rgba(0,0,0,0.15);
            transition: transform 0.3s ease;
        }
        
        .sidebar.collapsed { transform: translateX(-240px); }
        
        .sidebar-header {
            padding: 0 20px 30px; border-bottom: 1px solid #475569;
            margin-bottom: 20px;
        }
        
        .sidebar-header h2 {
            font-size: 18px; font-weight: 700; margin-bottom: 8px;
            color: #e2e8f0;
        }
        
        .sidebar-header .subtitle {
            font-size: 12px; color: #94a3b8; 
            text-transform: uppercase; letter-spacing: 1px;
        }
        
        .sidebar-menu {
            list-style: none;
        }
        
        .sidebar-menu li {
            margin-bottom: 4px;
        }
        
        .sidebar-menu a {
            display: flex; align-items: center; padding: 12px 20px;
            color: #cbd5e1; text-decoration: none; font-size: 14px;
            transition: all 0.3s ease; border-left: 3px solid transparent;
        }
        
        .sidebar-menu a:hover, .sidebar-menu a.active {
            background: rgba(59, 130, 246, 0.1); color: #3b82f6;
            border-left-color: #3b82f6;
        }
        
        .sidebar-menu a .icon {
            width: 20px; margin-right: 12px; font-size: 16px;
        }
        
        .main-content {
            margin-left: 280px; min-height: 100vh; 
            background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
            transition: margin-left 0.3s ease;
        }
        
        .main-content.expanded { margin-left: 40px; }
        
        .topbar {
            background: white; padding: 15px 30px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex; justify-content: space-between; align-items: center;
        }
        
        .toggle-sidebar {
            background: #f1f5f9; border: none; padding: 8px 12px;
            border-radius: 8px; cursor: pointer; font-size: 18px;
            transition: background 0.3s ease;
        }
        
        .toggle-sidebar:hover { background: #e2e8f0; }
        
        .topbar-right {
            display: flex; align-items: center; gap: 15px;
        }
        
        .device-selector {
            display: flex; align-items: center; gap: 10px;
            background: #f8fafc; padding: 8px 15px; border-radius: 10px;
            border: 1px solid #e2e8f0;
        }
        
        .device-selector select {
            border: none; background: transparent; font-size: 14px;
            color: #374151; font-weight: 500; cursor: pointer;
        }
        
        .content-area {
            padding: 30px;
        }
        
        .page-section {
            display: none;
        }
        
        .page-section.active {
            display: block;
        }
        
        .stats-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px; margin-bottom: 30px;
        }
        
        .stat-card {
            background: white; padding: 25px; border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid #f1f5f9; position: relative; overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }
        
        .stat-card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0;
            height: 4px; background: linear-gradient(90deg, #3b82f6, #10b981);
        }
        
        .stat-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .stat-title {
            font-size: 14px; font-weight: 600; color: #64748b;
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        
        .stat-icon {
            font-size: 24px; opacity: 0.7;
        }
        
        .stat-value {
            font-size: 32px; font-weight: 700; color: #1e293b;
            margin-bottom: 8px; line-height: 1;
        }
        
        .stat-change {
            font-size: 12px; display: flex; align-items: center; gap: 4px;
        }
        
        .stat-change.positive { color: #10b981; }
        .stat-change.negative { color: #ef4444; }
        .stat-change.neutral { color: #6b7280; }
        
        .devices-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px; margin-bottom: 30px;
        }
        
        .device-card {
            background: white; border-radius: 16px; padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border: 1px solid #f1f5f9; position: relative;
            transition: all 0.3s ease;
        }
        
        .device-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        
        .device-status {
            position: absolute; top: 15px; right: 15px;
            width: 12px; height: 12px; border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .device-status.online { background: #10b981; }
        .device-status.offline { background: #ef4444; animation: none; }
        .device-status.connecting { background: #f59e0b; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .device-info h3 {
            font-size: 18px; font-weight: 600; color: #1e293b;
            margin-bottom: 8px; display: flex; align-items: center; gap: 10px;
        }
        
        .device-meta {
            display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
            margin: 15px 0; font-size: 13px; color: #64748b;
        }
        
        .device-meta div {
            background: #f8fafc; padding: 8px 12px; border-radius: 8px;
        }
        
        .device-actions {
            display: flex; gap: 8px; margin-top: 15px; flex-wrap: wrap;
        }
        
        .btn {
            padding: 8px 16px; border-radius: 8px; border: none;
            font-size: 13px; font-weight: 500; cursor: pointer;
            transition: all 0.3s ease; text-decoration: none;
            display: inline-flex; align-items: center; gap: 6px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        .btn-secondary {
            background: #f1f5f9; color: #64748b;
        }
        
        .btn-secondary:hover {
            background: #e2e8f0;
        }
        
        .form-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 30px;
            margin-top: 20px;
        }
        
        .form-section {
            background: white; padding: 25px; border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        .form-section h3 {
            font-size: 18px; font-weight: 600; color: #1e293b;
            margin-bottom: 20px; display: flex; align-items: center; gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block; font-weight: 500; color: #374151;
            margin-bottom: 8px; font-size: 14px;
        }
        
        .form-control {
            width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb;
            border-radius: 10px; font-size: 14px; transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            outline: none; border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-control.textarea {
            min-height: 120px; resize: vertical;
        }
        
        .quick-actions {
            display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px;
        }
        
        .activity-feed {
            background: white; border-radius: 16px; padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-top: 30px;
        }
        
        .activity-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px;
        }
        
        .activity-header h3 {
            font-size: 18px; font-weight: 600; color: #1e293b;
        }
        
        .activity-item {
            display: flex; align-items: start; gap: 15px;
            padding: 15px 0; border-bottom: 1px solid #f1f5f9;
        }
        
        .activity-item:last-child { border-bottom: none; }
        
        .activity-icon {
            width: 40px; height: 40px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 16px; color: white; flex-shrink: 0;
        }
        
        .activity-icon.success { background: #10b981; }
        .activity-icon.error { background: #ef4444; }
        .activity-icon.info { background: #3b82f6; }
        .activity-icon.warning { background: #f59e0b; }
        
        .activity-content h4 {
            font-size: 14px; font-weight: 600; color: #1e293b;
            margin-bottom: 4px;
        }
        
        .activity-content p {
            font-size: 13px; color: #64748b; line-height: 1.4;
        }
        
        .activity-time {
            font-size: 11px; color: #94a3b8; margin-left: auto;
            flex-shrink: 0;
        }
        
        .metrics-row {
            display: grid; grid-template-columns: 2fr 1fr; gap: 30px;
            margin-top: 30px;
        }
        
        .chart-container {
            background: white; padding: 25px; border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        .notifications {
            position: fixed; top: 20px; right: 20px; z-index: 10000;
        }
        
        .notification {
            background: white; padding: 15px 20px; border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15); margin-bottom: 10px;
            border-left: 4px solid #3b82f6; min-width: 300px;
            transform: translateX(100%); animation: slideIn 0.3s ease forwards;
        }
        
        .notification.success { border-left-color: #10b981; }
        .notification.error { border-left-color: #ef4444; }
        .notification.warning { border-left-color: #f59e0b; }
        
        .notification.hide {
            animation: slideOut 0.3s ease forwards;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        .loading {
            display: inline-block; width: 20px; height: 20px;
            border: 2px solid #f3f3f3; border-top: 2px solid #3b82f6;
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .empty-state {
            text-align: center; padding: 60px 20px; color: #64748b;
        }
        
        .empty-state .icon {
            font-size: 48px; margin-bottom: 16px; opacity: 0.5;
        }
        
        .empty-state h3 {
            font-size: 18px; margin-bottom: 8px; color: #374151;
        }
        
        .empty-state p {
            font-size: 14px; line-height: 1.5;
        }
        
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .main-content { margin-left: 0; }
            .main-content.expanded { margin-left: 0; }
            .sidebar.mobile-open { transform: translateX(0); }
            .form-grid { grid-template-columns: 1fr; }
            .metrics-row { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Notifications Container -->
    <div class="notifications" id="notifications"></div>
    
    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>üöÄ WhatsApp Hub</h2>
            <div class="subtitle">Multi-Device Manager</div>
        </div>
        
        <ul class="sidebar-menu">
            <li><a href="#" class="menu-link active" data-page="dashboard">
                <span class="icon">üìä</span> Dashboard
            </a></li>
            <li><a href="#" class="menu-link" data-page="devices">
                <span class="icon">üì±</span> Device Management
            </a></li>
            <li><a href="#" class="menu-link" data-page="messaging">
                <span class="icon">üí¨</span> Send Messages
            </a></li>
            <li><a href="#" class="menu-link" data-page="bulk">
                <span class="icon">üì§</span> Bulk Messaging
            </a></li>
            <li><a href="#" class="menu-link" data-page="automation">
                <span class="icon">ü§ñ</span> Automation
            </a></li>
            <li><a href="#" class="menu-link" data-page="analytics">
                <span class="icon">üìà</span> Analytics
            </a></li>
            <li><a href="#" class="menu-link" data-page="logs">
                <span class="icon">üìã</span> System Logs
            </a></li>
            <li><a href="#" class="menu-link" data-page="settings">
                <span class="icon">‚öôÔ∏è</span> Settings
            </a></li>
        </ul>
    </nav>
    
    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <!-- Top Bar -->
        <div class="topbar">
            <div>
                <button class="toggle-sidebar" id="toggleSidebar">‚ò∞</button>
            </div>
            <div class="topbar-right">
                <div class="device-selector">
                    <span>üñ•Ô∏è</span>
                    <select id="activeDeviceSelector">
                        <option value="">Select Active Device</option>
                    </select>
                </div>
                <div style="font-size: 14px; color: #64748b;">
                    <span id="currentTime"></span>
                </div>
            </div>
        </div>
        
        <!-- Content Area -->
        <div class="content-area">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page-section active">
                <h1 style="margin-bottom: 30px; color: #1e293b; font-size: 28px; font-weight: 700;">
                    üìä Dashboard Overview
                </h1>
                
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Connected Devices</span>
                            <span class="stat-icon">üì±</span>
                        </div>
                        <div class="stat-value" id="connectedDevicesCount">0</div>
                        <div class="stat-change neutral" id="devicesChange">
                            <span>‚Üí</span> No changes
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Messages Today</span>
                            <span class="stat-icon">üí¨</span>
                        </div>
                        <div class="stat-value" id="messagesToday">0</div>
                        <div class="stat-change positive" id="messagesChange">
                            <span>‚Üó</span> +0% from yesterday
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Success Rate</span>
                            <span class="stat-icon">‚úÖ</span>
                        </div>
                        <div class="stat-value" id="successRate">0%</div>
                        <div class="stat-change positive" id="successChange">
                            <span>‚Üó</span> Healthy
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Active Automations</span>
                            <span class="stat-icon">ü§ñ</span>
                        </div>
                        <div class="stat-value" id="activeAutomations">0</div>
                        <div class="stat-change neutral" id="automationChange">
                            <span>‚Üí</span> Stable
                        </div>
                    </div>
                </div>
                
                <!-- Metrics Row -->
                <div class="metrics-row">
                    <div class="chart-container">
                        <h3 style="margin-bottom: 20px; color: #1e293b;">üìà Message Analytics</h3>
                        <div id="messageChart" style="height: 300px; display: flex; align-items: center; justify-content: center; color: #64748b;">
                            üìä Chart will be loaded here
                        </div>
                    </div>
                    
                    <div class="activity-feed">
                        <div class="activity-header">
                            <h3>üî• Recent Activity</h3>
                            <button class="btn btn-secondary" onclick="refreshActivity()">
                                <span>üîÑ</span> Refresh
                            </button>
                        </div>
                        <div id="activityList">
                            <div class="empty-state">
                                <div class="icon">üì≠</div>
                                <h3>No Recent Activity</h3>
                                <p>Activity will appear here when devices are connected</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Device Management Page -->
            <div id="devices" class="page-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h1 style="color: #1e293b; font-size: 28px; font-weight: 700;">
                        üì± Device Management
                    </h1>
                    <div class="quick-actions">
                        <button class="btn btn-primary" onclick="addNewDevice()">
                            <span>‚ûï</span> Add Device
                        </button>
                        <button class="btn btn-secondary" onclick="refreshDevices()">
                            <span>üîÑ</span> Refresh
                        </button>
                    </div>
                </div>
                
                <div class="devices-grid" id="devicesGrid">
                    <!-- Devices will be loaded here -->
                </div>
            </div>
            
            <!-- Messaging Page -->
            <div id="messaging" class="page-section">
                <h1 style="margin-bottom: 30px; color: #1e293b; font-size: 28px; font-weight: 700;">
                    üí¨ Send Messages
                </h1>
                
                <div class="form-grid">
                    <div class="form-section">
                        <h3>üì§ Quick Message</h3>
                        <div class="form-group">
                            <label>Select Device</label>
                            <select class="form-control" id="messageDeviceSelector">
                                <option value="">Choose active device</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Phone Number</label>
                            <input type="tel" class="form-control" id="quickPhone" placeholder="+91 98765 43210">
                        </div>
                        <div class="form-group">
                            <label>Message</label>
                            <textarea class="form-control textarea" id="quickMessage" placeholder="Type your message here..."></textarea>
                        </div>
                        <button class="btn btn-success" onclick="sendQuickMessage()">
                            <span>üì§</span> Send Message
                        </button>
                    </div>
                    
                    <div class="form-section">
                        <h3>üìã Message Templates</h3>
                        <div id="templatesList">
                            <div class="empty-state">
                                <div class="icon">üìù</div>
                                <h3>No Templates</h3>
                                <p>Create templates for quick messaging</p>
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <input type="text" class="form-control" id="templateName" placeholder="Template name" style="margin-bottom: 10px;">
                            <textarea class="form-control textarea" id="templateContent" placeholder="Template content"></textarea>
                            <button class="btn btn-primary" onclick="addTemplate()" style="margin-top: 10px;">
                                <span>‚ûï</span> Add Template
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Bulk Messaging Page -->
            <div id="bulk" class="page-section">
                <h1 style="margin-bottom: 30px; color: #1e293b; font-size: 28px; font-weight: 700;">
                    üì§ Bulk Messaging
                </h1>
                
                <div class="form-section">
                    <div class="form-grid">
                        <div>
                            <h3>üìä Recipients</h3>
                            <div class="form-group">
                                <label>Select Device</label>
                                <select class="form-control" id="bulkDeviceSelector">
                                    <option value="">Choose active device</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Phone Numbers (one per line)</label>
                                <textarea class="form-control textarea" id="bulkNumbers" placeholder="919876543210&#10;919876543211&#10;919876543212" style="height: 200px;"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Or Upload CSV</label>
                                <input type="file" class="form-control" id="csvUpload" accept=".csv,.txt" onchange="handleCSVUpload(event)">
                            </div>
                        </div>
                        <div>
                            <h3>‚úâÔ∏è Message Content</h3>
                            <div class="form-group">
                                <label>Message</label>
                                <textarea class="form-control textarea" id="bulkMessage" placeholder="Your bulk message content..." style="height: 200px;"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Send Delay (seconds)</label>
                                <input type="number" class="form-control" id="bulkDelay" value="5" min="3" max="60">
                            </div>
                            <button class="btn btn-success" onclick="sendBulkMessage()">
                                <span>üì®</span> Start Bulk Send
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Automation Page -->
            <div id="automation" class="page-section">
                <h1 style="margin-bottom: 30px; color: #1e293b; font-size: 28px; font-weight: 700;">
                    ü§ñ Automation Settings
                </h1>
                
                <div class="form-grid">
                    <div class="form-section">
                        <h3>‚ö° Auto-Reply</h3>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="autoReplyEnabled" style="margin-right: 8px;">
                                Enable Auto-Reply
                            </label>
                        </div>
                        <div class="form-group">
                            <label>Reply Message</label>
                            <textarea class="form-control textarea" id="autoReplyText" placeholder="Thank you for your message. We'll get back to you soon!"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Reply Delay (seconds)</label>
                            <input type="number" class="form-control" id="autoReplyDelay" value="3" min="1" max="60">
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>üìÖ Scheduled Messages</h3>
                        <div id="scheduledMessagesList">
                            <div class="empty-state">
                                <div class="icon">‚è∞</div>
                                <h3>No Scheduled Messages</h3>
                                <p>Schedule messages for future delivery</p>
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <input type="tel" class="form-control" id="schedulePhone" placeholder="Phone number" style="margin-bottom: 10px;">
                            <textarea class="form-control" id="scheduleMessage" placeholder="Message content" style="margin-bottom: 10px; height: 80px;"></textarea>
                            <input type="datetime-local" class="form-control" id="scheduleDateTime" style="margin-bottom: 10px;">
                            <button class="btn btn-primary" onclick="scheduleMessage()">
                                <span>‚è∞</span> Schedule Message
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="quick-actions" style="margin-top: 20px;">
                    <button class="btn btn-success" onclick="saveAutomationSettings()">
                        <span>üíæ</span> Save Settings
                    </button>
                    <button class="btn btn-secondary" onclick="loadAutomationSettings()">
                        <span>üîÑ</span> Reload
                    </button>
                </div>
            </div>
            
            <!-- Analytics Page -->
            <div id="analytics" class="page-section">
                <h1 style="margin-bottom: 30px; color: #1e293b; font-size: 28px; font-weight: 700;">
                    üìà Analytics & Reports
                </h1>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Total Messages Sent</span>
                            <span class="stat-icon">üì§</span>
                        </div>
                        <div class="stat-value" id="totalSent">0</div>
                        <div class="stat-change" id="totalSentChange"></div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Messages Received</span>
                            <span class="stat-icon">üì•</span>
                        </div>
                        <div class="stat-value" id="totalReceived">0</div>
                        <div class="stat-change" id="totalReceivedChange"></div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Failed Messages</span>
                            <span class="stat-icon">‚ùå</span>
                        </div>
                        <div class="stat-value" id="totalFailed">0</div>
                        <div class="stat-change" id="totalFailedChange"></div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Uptime</span>
                            <span class="stat-icon">‚è±Ô∏è</span>
                        </div>
                        <div class="stat-value" id="systemUptime">0h</div>
                        <div class="stat-change positive">
                            <span>‚úÖ</span> Running
                        </div>
                    </div>
                </div>
                
                <div class="chart-container" style="margin-top: 30px;">
                    <h3 style="margin-bottom: 20px;">üìä Message Trends (Last 7 Days)</h3>
                    <div id="analyticsChart" style="height: 400px; display: flex; align-items: center; justify-content: center; color: #64748b;">
                        üìà Detailed analytics chart will be displayed here
                    </div>
                </div>
            </div>
            
            <!-- System Logs Page -->
            <div id="logs" class="page-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h1 style="color: #1e293b; font-size: 28px; font-weight: 700;">
                        üìã System Logs
                    </h1>
                    <div class="quick-actions">
                        <button class="btn btn-secondary" onclick="refreshLogs()">
                            <span>üîÑ</span> Refresh
                        </button>
                        <button class="btn btn-danger" onclick="clearLogs()">
                            <span>üóëÔ∏è</span> Clear Logs
                        </button>
                    </div>
                </div>
                
                <div style="background: #1e293b; border-radius: 12px; padding: 20px; color: #e2e8f0; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.6; max-height: 600px; overflow-y: auto;" id="terminalLogs">
                    <div style="color: #10b981; margin-bottom: 10px;">
                        üöÄ WhatsApp Multi-Device Hub - Live System Logs
                    </div>
                    <div style="color: #64748b; margin-bottom: 20px;">
                        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                    </div>
                    <div id="logEntries">
                        <div style="color: #94a3b8;">[SYSTEM] Waiting for log entries...</div>
                    </div>
                </div>
            </div>
            
            <!-- Settings Page -->
            <div id="settings" class="page-section">
                <h1 style="margin-bottom: 30px; color: #1e293b; font-size: 28px; font-weight: 700;">
                    ‚öôÔ∏è System Settings
                </h1>
                
                <div class="form-grid">
                    <div class="form-section">
                        <h3>üîí Security Settings</h3>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="safeMode" style="margin-right: 8px;">
                                Enable Safe Mode
                            </label>
                            <small style="color: #64748b; display: block; margin-top: 4px;">
                                Conservative sending limits to prevent bans
                            </small>
                        </div>
                        <div class="form-group">
                            <label>Daily Send Limit</label>
                            <input type="number" class="form-control" id="dailyLimit" value="100" min="1" max="1000">
                        </div>
                        <div class="form-group">
                            <label>Hourly Send Limit</label>
                            <input type="number" class="form-control" id="hourlyLimit" value="20" min="1" max="100">
                        </div>
                        <div class="form-group">
                            <label>Min Send Delay (seconds)</label>
                            <input type="number" class="form-control" id="minDelay" value="3" min="1" max="60">
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>üéõÔ∏è System Controls</h3>
                        <div class="quick-actions">
                            <button class="btn btn-success" onclick="saveSettings()">
                                <span>üíæ</span> Save All Settings
                            </button>
                            <button class="btn btn-primary" onclick="downloadBackup()">
                                <span>üíæ</span> Download Backup
                            </button>
                            <button class="btn btn-danger" onclick="logoutAllDevices()">
                                <span>üîì</span> Logout All Devices
                            </button>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h4 style="margin-bottom: 15px;">üìä System Status</h4>
                            <div style="background: #f8fafc; padding: 15px; border-radius: 8px; font-size: 14px;">
                                <div style="margin-bottom: 8px;">
                                    <strong>Server Status:</strong> <span style="color: #10b981;" id="serverStatus">‚óè</span> Online
                                </div>
                                <div style="margin-bottom: 8px;">
                                    <strong>Active Connections:</strong> <span id="activeConnections">0</span>
                                </div>
                                <div style="margin-bottom: 8px;">
                                    <strong>Memory Usage:</strong> <span id="memoryUsage">N/A</span>
                                </div>
                                <div>
                                    <strong>Last Updated:</strong> <span id="lastUpdated">Just now</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Global variables
        let currentPage = 'dashboard';
        let devices = [];
        let refreshInterval;
        let logInterval;
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            setupEventListeners();
            loadInitialData();
            startRealTimeUpdates();
        });
        
        // Initialize dashboard
        function initializeDashboard() {
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            
            // Set minimum datetime for scheduler
            const now = new Date();
            now.setMinutes(now.getMinutes() + 1);
            document.getElementById('scheduleDateTime').min = now.toISOString().slice(0, 16);
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Sidebar toggle
            document.getElementById('toggleSidebar').addEventListener('click', toggleSidebar);
            
            // Menu navigation
            document.querySelectorAll('.menu-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    navigateToPage(page);
                });
            });
            
            // Device selector change
            document.getElementById('activeDeviceSelector').addEventListener('change', handleDeviceChange);
        }
        
        // Navigation functions
        function navigateToPage(page) {
            // Update active menu item
            document.querySelectorAll('.menu-link').forEach(link => link.classList.remove('active'));
            document.querySelector(`[data-page="${page}"]`).classList.add('active');
            
            // Show selected page
            document.querySelectorAll('.page-section').forEach(section => section.classList.remove('active'));
            document.getElementById(page).classList.add('active');
            
            currentPage = page;
            
            // Load page-specific data
            loadPageData(page);
        }
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
        }
        
        // Data loading functions
        async function loadInitialData() {
            await loadDevices();
            await loadStats();
            await loadLogs();
            updateDeviceSelectors();
        }
        
        async function loadPageData(page) {
            switch(page) {
                case 'dashboard':
                    await loadStats();
                    await loadActivity();
                    break;
                case 'devices':
                    await loadDevices();
                    break;
                case 'logs':
                    await loadLogs();
                    break;
                case 'analytics':
                    await loadAnalytics();
                    break;
                case 'automation':
                    await loadAutomationSettings();
                    await loadScheduledMessages();
                    break;
            }
        }
        
        // Device management
        async function loadDevices() {
            try {
                const response = await fetchWithAuth('/api/devices');
                const result = await response.json();
                
                if (result.success) {
                    devices = result.data || [];
                    displayDevices();
                    updateDeviceStats();
                } else {
                    // Handle single device for backward compatibility
                    const statusResponse = await fetchWithAuth('/api/info');
                    const statusResult = await statusResponse.json();
                    
                    if (statusResult.success && statusResult.data.connected) {
                        devices = [{
                            id: 'primary',
                            name: 'Primary Device',
                            phone: statusResult.data.jid,
                            status: 'online',
                            platform: 'WhatsApp Web',
                            lastSeen: new Date(),
                            messagesCount: 0,
                            isActive: true
                        }];
                        displayDevices();
                        updateDeviceStats();
                    }
                }
            } catch (error) {
                console.error('Error loading devices:', error);
                showNotification('Failed to load devices', 'error');
            }
        }
        
        function displayDevices() {
            const devicesGrid = document.getElementById('devicesGrid');
            
            if (devices.length === 0) {
                devicesGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="icon">üì±</div>
                        <h3>No Devices Connected</h3>
                        <p>Add your first WhatsApp device to get started</p>
                        <button class="btn btn-primary" onclick="addNewDevice()" style="margin-top: 15px;">
                            <span>‚ûï</span> Add Device
                        </button>
                    </div>
                `;
                return;
            }
            
            devicesGrid.innerHTML = devices.map(device => `
                <div class="device-card">
                    <div class="device-status ${device.status}"></div>
                    <div class="device-info">
                        <h3>
                            üì± ${device.name}
                            ${device.isActive ? '<span style="font-size: 12px; background: #10b981; color: white; padding: 2px 8px; border-radius: 12px; margin-left: 8px;">ACTIVE</span>' : ''}
                        </h3>
                        <div class="device-meta">
                            <div><strong>üìû Phone:</strong> ${device.phone || 'N/A'}</div>
                            <div><strong>üíª Platform:</strong> ${device.platform || 'Unknown'}</div>
                            <div><strong>üìä Messages:</strong> ${device.messagesCount || 0}</div>
                            <div><strong>‚è∞ Last Seen:</strong> ${formatLastSeen(device.lastSeen)}</div>
                        </div>
                        <div class="device-actions">
                            <button class="btn btn-primary" onclick="selectActiveDevice('${device.id}')">
                                <span>‚úÖ</span> Set Active
                            </button>
                            <button class="btn btn-success" onclick="testDevice('${device.id}')">
                                <span>üß™</span> Test
                            </button>
                            <button class="btn btn-secondary" onclick="viewDeviceDetails('${device.id}')">
                                <span>üëÅÔ∏è</span> Details
                            </button>
                            <button class="btn btn-danger" onclick="disconnectDevice('${device.id}')">
                                <span>üîå</span> Disconnect
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function updateDeviceSelectors() {
            const selectors = ['activeDeviceSelector', 'messageDeviceSelector', 'bulkDeviceSelector'];
            
            selectors.forEach(selectorId => {
                const selector = document.getElementById(selectorId);
                const currentValue = selector.value;
                
                selector.innerHTML = '<option value="">Select Device</option>' +
                    devices.filter(d => d.status === 'online').map(device => 
                        `<option value="${device.id}" ${device.isActive ? 'selected' : ''}>${device.name} (${device.phone})</option>`
                    ).join('');
                
                // Restore previous selection if still valid
                if (currentValue && selector.querySelector(`option[value="${currentValue}"]`)) {
                    selector.value = currentValue;
                }
            });
        }
        
        // Device actions
        async function addNewDevice() {
            window.open('/pair', '_blank', 'width=500,height=600');
            showNotification('Opening device pairing window...', 'info');
        }
        
        async function selectActiveDevice(deviceId) {
            try {
                const response = await fetchWithAuth('/api/device/activate', {
                    method: 'POST',
                    body: JSON.stringify({ deviceId })
                });
                
                const result = await response.json();
                if (result.success) {
                    // Update local devices array
                    devices.forEach(d => d.isActive = d.id === deviceId);
                    displayDevices();
                    updateDeviceSelectors();
                    showNotification(`Device activated: ${devices.find(d => d.id === deviceId)?.name}`, 'success');
                } else {
                    showNotification(result.message || 'Failed to activate device', 'error');
                }
            } catch (error) {
                showNotification('Error activating device', 'error');
            }
        }
        
        async function testDevice(deviceId) {
            try {
                showNotification('Testing device connection...', 'info');
                
                const response = await fetchWithAuth('/api/device/test', {
                    method: 'POST',
                    body: JSON.stringify({ deviceId })
                });
                
                const result = await response.json();
                if (result.success) {
                    showNotification('Device test successful!', 'success');
                } else {
                    showNotification(result.message || 'Device test failed', 'error');
                }
            } catch (error) {
                showNotification('Error testing device', 'error');
            }
        }
        
        async function disconnectDevice(deviceId) {
            if (!confirm('Are you sure you want to disconnect this device?')) return;
            
            try {
                const response = await fetchWithAuth('/api/device/disconnect', {
                    method: 'POST',
                    body: JSON.stringify({ deviceId })
                });
                
                const result = await response.json();
                if (result.success) {
                    loadDevices(); // Reload devices
                    showNotification('Device disconnected successfully', 'success');
                } else {
                    showNotification(result.message || 'Failed to disconnect device', 'error');
                }
            } catch (error) {
                showNotification('Error disconnecting device', 'error');
            }
        }
        
        // Statistics and analytics
        async function loadStats() {
            try {
                const response = await fetchWithAuth('/api/stats');
                const result = await response.json();
                
                if (result.success) {
                    updateDashboardStats(result.data);
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }
        
        function updateDashboardStats(stats) {
            document.getElementById('connectedDevicesCount').textContent = devices.filter(d => d.status === 'online').length;
            document.getElementById('messagesToday').textContent = stats.daily_counts?.[new Date().toISOString().split('T')[0]] || 0;
            document.getElementById('totalSent').textContent = stats.total_sent || 0;
            document.getElementById('totalReceived').textContent = stats.total_received || 0;
            document.getElementById('totalFailed').textContent = stats.total_failed || 0;
            
            // Calculate success rate
                        const total = (stats.total_sent || 0) + (stats.total_failed || 0);
            const successRate = total > 0 ? Math.round((stats.total_sent / total) * 100) : 0;
            document.getElementById('successRate').textContent = successRate + '%';
            
            // Update automations count
            document.getElementById('activeAutomations').textContent = stats.active_automations || 0;
        }
        
        function updateDeviceStats() {
            const onlineDevices = devices.filter(d => d.status === 'online').length;
            document.getElementById('connectedDevicesCount').textContent = onlineDevices;
            document.getElementById('activeConnections').textContent = onlineDevices;
        }
        
        // Activity feed
        async function loadActivity() {
            try {
                const response = await fetchWithAuth('/api/logs');
                const result = await response.json();
                
                if (result.success && result.data) {
                    displayActivity(result.data.slice(0, 10)); // Show last 10 activities
                }
            } catch (error) {
                console.error('Error loading activity:', error);
            }
        }
        
        function displayActivity(logs) {
            const activityList = document.getElementById('activityList');
            
            if (!logs || logs.length === 0) {
                activityList.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üì≠</div>
                        <h3>No Recent Activity</h3>
                        <p>Activity will appear here when devices are connected</p>
                    </div>
                `;
                return;
            }
            
            activityList.innerHTML = logs.map(log => {
                const activityType = getActivityType(log);
                return `
                    <div class="activity-item">
                        <div class="activity-icon ${activityType.class}">
                            ${activityType.icon}
                        </div>
                        <div class="activity-content">
                            <h4>${activityType.title}</h4>
                            <p>${log}</p>
                        </div>
                        <div class="activity-time">${getRelativeTime()}</div>
                    </div>
                `;
            }).join('');
        }
        
        function getActivityType(log) {
            if (log.includes('‚úÖ') || log.includes('success') || log.includes('sent')) {
                return { icon: '‚úÖ', class: 'success', title: 'Success' };
            } else if (log.includes('‚ùå') || log.includes('failed') || log.includes('error')) {
                return { icon: '‚ùå', class: 'error', title: 'Error' };
            } else if (log.includes('‚ö†Ô∏è') || log.includes('warning')) {
                return { icon: '‚ö†Ô∏è', class: 'warning', title: 'Warning' };
            } else {
                return { icon: '‚ÑπÔ∏è', class: 'info', title: 'Info' };
            }
        }
        
        // Messaging functions
        async function sendQuickMessage() {
            const deviceId = document.getElementById('messageDeviceSelector').value;
            const phone = document.getElementById('quickPhone').value.trim();
            const message = document.getElementById('quickMessage').value.trim();
            
            if (!deviceId) {
                showNotification('Please select a device', 'warning');
                return;
            }
            
            if (!phone || !message) {
                showNotification('Phone number and message are required', 'warning');
                return;
            }
            
            try {
                showNotification('Sending message...', 'info');
                
                const response = await fetchWithAuth(`/send?phone=${encodeURIComponent(phone)}&text=${encodeURIComponent(message)}&device=${deviceId}`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Message sent successfully!', 'success');
                    document.getElementById('quickPhone').value = '';
                    document.getElementById('quickMessage').value = '';
                    loadStats(); // Update stats
                } else {
                    showNotification(result.message || 'Failed to send message', 'error');
                }
            } catch (error) {
                showNotification('Error sending message: ' + error.message, 'error');
            }
        }
        
        // Bulk messaging
        async function sendBulkMessage() {
            const deviceId = document.getElementById('bulkDeviceSelector').value;
            const numbers = document.getElementById('bulkNumbers').value.trim().split('\n').filter(n => n.trim());
            const message = document.getElementById('bulkMessage').value.trim();
            const delay = parseInt(document.getElementById('bulkDelay').value) || 5;
            
            if (!deviceId) {
                showNotification('Please select a device', 'warning');
                return;
            }
            
            if (numbers.length === 0 || !message) {
                showNotification('Numbers and message are required', 'warning');
                return;
            }
            
            if (!confirm(`Send message to ${numbers.length} numbers?`)) return;
            
            try {
                showNotification(`Starting bulk send to ${numbers.length} numbers...`, 'info');
                
                const response = await fetchWithAuth('/api/bulk-send', {
                    method: 'POST',
                    body: JSON.stringify({
                        deviceId,
                        numbers,
                        message,
                        delay
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Bulk messaging started successfully!', 'success');
                    document.getElementById('bulkNumbers').value = '';
                    document.getElementById('bulkMessage').value = '';
                } else {
                    showNotification(result.message || 'Failed to start bulk messaging', 'error');
                }
            } catch (error) {
                showNotification('Error starting bulk send: ' + error.message, 'error');
            }
        }
        
        function handleCSVUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                const lines = content.split('\n').filter(line => line.trim());
                const numbers = lines.map(line => {
                    // Extract first column or the whole line if no comma
                    return line.split(',')[0].trim();
                }).filter(n => n);
                
                document.getElementById('bulkNumbers').value = numbers.join('\n');
                showNotification(`Loaded ${numbers.length} numbers from CSV`, 'success');
            };
            reader.readAsText(file);
        }
        
        // Template management
        async function addTemplate() {
            const name = document.getElementById('templateName').value.trim();
            const content = document.getElementById('templateContent').value.trim();
            
            if (!name || !content) {
                showNotification('Template name and content are required', 'warning');
                return;
            }
            
            try {
                const response = await fetchWithAuth('/api/templates', {
                    method: 'POST',
                    body: JSON.stringify({ name, content })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Template added successfully!', 'success');
                    document.getElementById('templateName').value = '';
                    document.getElementById('templateContent').value = '';
                    loadTemplates();
                } else {
                    showNotification(result.message || 'Failed to add template', 'error');
                }
            } catch (error) {
                showNotification('Error adding template', 'error');
            }
        }
        
        async function loadTemplates() {
            try {
                const response = await fetchWithAuth('/api/config');
                const result = await response.json();
                
                if (result.success && result.data.templates) {
                    displayTemplates(result.data.templates);
                }
            } catch (error) {
                console.error('Error loading templates:', error);
            }
        }
        
        function displayTemplates(templates) {
            const templatesList = document.getElementById('templatesList');
            
            if (!templates || templates.length === 0) {
                templatesList.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üìù</div>
                        <h3>No Templates</h3>
                        <p>Create templates for quick messaging</p>
                    </div>
                `;
                return;
            }
            
            templatesList.innerHTML = templates.map((template, index) => `
                <div style="background: #f8fafc; padding: 12px; border-radius: 8px; margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <strong style="color: #1e293b;">${template.name}</strong>
                        <div>
                            <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="useTemplate(${index})">Use</button>
                            <button class="btn btn-danger" style="padding: 4px 8px; font-size: 12px; margin-left: 4px;" onclick="deleteTemplate(${index})">√ó</button>
                        </div>
                    </div>
                    <p style="font-size: 13px; color: #64748b; margin: 0;">${template.content.substring(0, 100)}${template.content.length > 100 ? '...' : ''}</p>
                </div>
            `).join('');
        }
        
        function useTemplate(index) {
            // This will be implemented based on your config structure
            showNotification('Template copied to message field', 'success');
        }
        
        // Automation settings
        async function saveAutomationSettings() {
            const autoReplyEnabled = document.getElementById('autoReplyEnabled').checked;
            const autoReplyText = document.getElementById('autoReplyText').value.trim();
            const autoReplyDelay = parseInt(document.getElementById('autoReplyDelay').value) || 3;
            
            try {
                const response = await fetchWithAuth('/api/config', {
                    method: 'POST',
                    body: JSON.stringify({
                        reply_enable: autoReplyEnabled,
                        reply_text: autoReplyText,
                        auto_reply_delay: autoReplyDelay
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Automation settings saved!', 'success');
                } else {
                    showNotification(result.message || 'Failed to save settings', 'error');
                }
            } catch (error) {
                showNotification('Error saving settings', 'error');
            }
        }
        
        async function loadAutomationSettings() {
            try {
                const response = await fetchWithAuth('/api/config');
                const result = await response.json();
                
                if (result.success && result.data) {
                    document.getElementById('autoReplyEnabled').checked = result.data.reply_enable || false;
                    document.getElementById('autoReplyText').value = result.data.reply_text || '';
                    document.getElementById('autoReplyDelay').value = result.data.auto_reply_delay || 3;
                }
            } catch (error) {
                console.error('Error loading automation settings:', error);
            }
        }
        
        async function scheduleMessage() {
            const phone = document.getElementById('schedulePhone').value.trim();
            const message = document.getElementById('scheduleMessage').value.trim();
            const datetime = document.getElementById('scheduleDateTime').value;
            
            if (!phone || !message || !datetime) {
                showNotification('All fields are required for scheduling', 'warning');
                return;
            }
            
            try {
                const response = await fetchWithAuth('/api/schedule', {
                    method: 'POST',
                    body: JSON.stringify({
                        phone,
                        message,
                        scheduled_at: datetime
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Message scheduled successfully!', 'success');
                    document.getElementById('schedulePhone').value = '';
                    document.getElementById('scheduleMessage').value = '';
                    document.getElementById('scheduleDateTime').value = '';
                    loadScheduledMessages();
                } else {
                    showNotification(result.message || 'Failed to schedule message', 'error');
                }
            } catch (error) {
                showNotification('Error scheduling message', 'error');
            }
        }
        
        async function loadScheduledMessages() {
            try {
                const response = await fetchWithAuth('/api/scheduled');
                const result = await response.json();
                
                if (result.success && result.data) {
                    displayScheduledMessages(result.data);
                }
            } catch (error) {
                console.error('Error loading scheduled messages:', error);
            }
        }
        
        function displayScheduledMessages(messages) {
            const list = document.getElementById('scheduledMessagesList');
            
            if (!messages || messages.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">‚è∞</div>
                        <h3>No Scheduled Messages</h3>
                        <p>Schedule messages for future delivery</p>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = messages.map(msg => `
                <div style="background: #f8fafc; padding: 12px; border-radius: 8px; margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                        <strong style="color: #1e293b;">To: ${msg.phone}</strong>
                        <span style="font-size: 12px; padding: 2px 8px; border-radius: 12px; background: ${msg.status === 'pending' ? '#f59e0b' : msg.status === 'sent' ? '#10b981' : '#ef4444'}; color: white;">
                            ${msg.status}
                        </span>
                    </div>
                    <p style="font-size: 13px; color: #64748b; margin: 4px 0;">${msg.message.substring(0, 80)}...</p>
                    <div style="font-size: 12px; color: #94a3b8;">
                        ‚è∞ ${new Date(msg.scheduled_at).toLocaleString()}
                    </div>
                </div>
            `).join('');
        }
        
        // Logs management
        async function loadLogs() {
            try {
                const response = await fetchWithAuth('/api/logs');
                const result = await response.json();
                
                if (result.success && result.data) {
                    displayLogs(result.data);
                }
            } catch (error) {
                console.error('Error loading logs:', error);
            }
        }
        
        function displayLogs(logs) {
            const logEntries = document.getElementById('logEntries');
            
            if (!logs || logs.length === 0) {
                logEntries.innerHTML = '<div style="color: #94a3b8;">[SYSTEM] No log entries available</div>';
                return;
            }
            
            logEntries.innerHTML = logs.map(log => {
                let color = '#e2e8f0';
                if (log.includes('ERROR') || log.includes('‚ùå')) color = '#ef4444';
                else if (log.includes('WARN') || log.includes('‚ö†Ô∏è')) color = '#f59e0b';
                else if (log.includes('SUCCESS') || log.includes('‚úÖ')) color = '#10b981';
                else if (log.includes('SECURITY') || log.includes('üîí')) color = '#3b82f6';
                
                return `<div style="color: ${color}; margin-bottom: 4px;">${escapeHtml(log)}</div>`;
            }).join('');
            
            // Auto-scroll to bottom
            const terminal = document.getElementById('terminalLogs');
            terminal.scrollTop = terminal.scrollHeight;
        }
        
        async function refreshLogs() {
            showNotification('Refreshing logs...', 'info');
            await loadLogs();
            showNotification('Logs refreshed', 'success');
        }
        
        async function clearLogs() {
            if (!confirm('Are you sure you want to clear all logs?')) return;
            
            try {
                const response = await fetchWithAuth('/api/logs/clear', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Logs cleared successfully', 'success');
                    loadLogs();
                } else {
                    showNotification('Failed to clear logs', 'error');
                }
            } catch (error) {
                showNotification('Error clearing logs', 'error');
            }
        }
        
        // Analytics
        async function loadAnalytics() {
            await loadStats();
            // Additional analytics loading can be added here
        }
        
        // Settings management
        async function saveSettings() {
            const safeMode = document.getElementById('safeMode').checked;
            const dailyLimit = parseInt(document.getElementById('dailyLimit').value) || 100;
            const hourlyLimit = parseInt(document.getElementById('hourlyLimit').value) || 20;
            const minDelay = parseInt(document.getElementById('minDelay').value) || 3;
            
            try {
                const response = await fetchWithAuth('/api/config', {
                    method: 'POST',
                    body: JSON.stringify({
                        safe_mode: safeMode,
                        daily_send_limit: dailyLimit,
                        hourly_send_limit: hourlyLimit,
                        min_send_delay: minDelay
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Settings saved successfully!', 'success');
                } else {
                    showNotification(result.message || 'Failed to save settings', 'error');
                }
            } catch (error) {
                showNotification('Error saving settings', 'error');
            }
        }
        
        async function loadSettings() {
            try {
                const response = await fetchWithAuth('/api/config');
                const result = await response.json();
                
                if (result.success && result.data) {
                    document.getElementById('safeMode').checked = result.data.safe_mode || false;
                    document.getElementById('dailyLimit').value = result.data.daily_send_limit || 100;
                    document.getElementById('hourlyLimit').value = result.data.hourly_send_limit || 20;
                    document.getElementById('minDelay').value = result.data.min_send_delay || 3;
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }
        
        async function downloadBackup() {
            try {
                const response = await fetchWithAuth('/api/backup');
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `whatsapp-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                showNotification('Backup downloaded successfully', 'success');
            } catch (error) {
                showNotification('Error downloading backup', 'error');
            }
        }
        
        async function logoutAllDevices() {
            if (!confirm('Are you sure you want to logout all devices? This action cannot be undone.')) return;
            
            try {
                const response = await fetchWithAuth('/logout', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('All devices logged out successfully', 'success');
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                } else {
                    showNotification(result.message || 'Failed to logout devices', 'error');
                }
            } catch (error) {
                showNotification('Error logging out devices', 'error');
            }
        }
        
        // Real-time updates
        function startRealTimeUpdates() {
            // Refresh stats every 10 seconds
            refreshInterval = setInterval(async () => {
                if (document.visibilityState === 'visible') {
                    await loadStats();
                    if (currentPage === 'dashboard') {
                        await loadActivity();
                    }
                }
            }, 10000);
            
            // Refresh logs every 5 seconds if on logs page
            logInterval = setInterval(async () => {
                if (currentPage === 'logs' && document.visibilityState === 'visible') {
                    await loadLogs();
                }
            }, 5000);
            
            // Update system uptime
            setInterval(updateSystemUptime, 1000);
        }
        
        // Helper functions
        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString();
        }
        
        function updateSystemUptime() {
            // This would calculate from server start time in a real implementation
            const uptime = '24h 15m';
            const uptimeElement = document.getElementById('systemUptime');
            if (uptimeElement) {
                uptimeElement.textContent = uptime;
            }
        }
        
        function formatLastSeen(lastSeen) {
            if (!lastSeen) return 'Unknown';
            const date = new Date(lastSeen);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
            return date.toLocaleDateString();
        }
        
        function getRelativeTime() {
            return 'Just now'; // Simplified - would calculate actual relative time
        }
        
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }
        
        async function fetchWithAuth(url, options = {}) {
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    ...options.headers
                },
                ...options
            };
            
            return fetch(url, defaultOptions);
        }
        
        function showNotification(message, type = 'info') {
            const notifications = document.getElementById('notifications');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 18px;">${icons[type]}</span>
                    <div style="flex: 1;">
                        <strong style="display: block; margin-bottom: 2px; font-size: 14px;">${type.charAt(0).toUpperCase() + type.slice(1)}</strong>
                        <p style="margin: 0; font-size: 13px; color: #64748b;">${message}</p>
                    </div>
                </div>
            `;
            
            notifications.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('hide');
                setTimeout(() => {
                    notifications.removeChild(notification);
                }, 300);
            }, 5000);
        }
        
        function handleDeviceChange(e) {
            const deviceId = e.target.value;
            if (deviceId) {
                const device = devices.find(d => d.id === deviceId);
                if (device) {
                    showNotification(`Switched to: ${device.name}`, 'info');
                }
            }
        }
        
        function refreshActivity() {
            loadActivity();
            showNotification('Activity refreshed', 'success');
        }
        
        function refreshDevices() {
            loadDevices();
            showNotification('Devices refreshed', 'success');
        }
        
        function viewDeviceDetails(deviceId) {
            const device = devices.find(d => d.id === deviceId);
            if (!device) return;
            
            alert(`Device Details:\n\nName: ${device.name}\nPhone: ${device.phone}\nStatus: ${device.status}\nPlatform: ${device.platform}\nMessages: ${device.messagesCount}\nLast Seen: ${formatLastSeen(device.lastSeen)}`);
        }
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            clearInterval(refreshInterval);
            clearInterval(logInterval);
        });
        
        // Load initial settings
        if (currentPage === 'settings') {
            loadSettings();
        }
        
        if (currentPage === 'automation') {
            loadAutomationSettings();
            loadScheduledMessages();
        }
        
        if (currentPage === 'messaging') {
            loadTemplates();
        }
    </script>
</body>
</html>
