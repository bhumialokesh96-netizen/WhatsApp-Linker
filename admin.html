<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Business Management Hub</title>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Feather Icons -->
    <link rel="stylesheet" href="https://unpkg.com/feather-icons/dist/feather.css">
    <!-- Custom Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --whatsapp-primary: #25D366;
            --whatsapp-dark: #075E54;
            --whatsapp-light: #DCF8C6;
            --whatsapp-bg: #0B141A;
            --whatsapp-secondary: #128C7E;
            --sidebar-bg: linear-gradient(180deg, #1e3a8a 0%, #1e40af 50%, #2563eb 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #3b82f6;
        }
        
        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
        }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text-primary); overflow-x: hidden; line-height: 1.6;
        }
        
        .sidebar {
            position: fixed; left: 0; top: 0; width: 280px; height: 100vh;
            background: var(--sidebar-bg);
            color: white; padding: 0; z-index: 1000;
            box-shadow: 4px 0 25px rgba(0,0,0,0.15);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
        }
        
        .sidebar.collapsed { transform: translateX(-240px); }
        
        .sidebar-header {
            padding: 25px 20px; border-bottom: 1px solid rgba(255,255,255,0.1);
            background: rgba(0,0,0,0.2); position: relative;
        }
        
        .sidebar-header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        }
        
        .logo-container {
            display: flex; align-items: center; gap: 15px; position: relative; z-index: 1;
        }
        
        .whatsapp-logo {
            width: 45px; height: 45px; background: var(--whatsapp-primary);
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
        }
        
        .whatsapp-logo i {
            font-size: 24px; color: white;
        }
        
        .brand-text h2 {
            font-size: 20px; font-weight: 700; margin-bottom: 2px;
            background: linear-gradient(135deg, #ffffff 0%, #e2e8f0 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .brand-text .subtitle {
            font-size: 11px; color: rgba(255,255,255,0.7); 
            text-transform: uppercase; letter-spacing: 1.2px; font-weight: 500;
        }
        
        .sidebar-menu {
            list-style: none; padding: 20px 0;
        }
        
        .sidebar-menu li {
            margin-bottom: 2px;
        }
        
        .sidebar-menu a {
            display: flex; align-items: center; padding: 14px 20px;
            color: rgba(255,255,255,0.8); text-decoration: none; font-size: 14px;
            font-weight: 500; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            border-left: 3px solid transparent; position: relative; overflow: hidden;
        }
        
        .sidebar-menu a::before {
            content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            transition: width 0.3s ease;
        }
        
        .sidebar-menu a:hover::before, .sidebar-menu a.active::before {
            width: 100%;
        }
        
        .sidebar-menu a:hover, .sidebar-menu a.active {
            color: #ffffff; border-left-color: var(--whatsapp-primary);
            background: rgba(37, 211, 102, 0.15);
            transform: translateX(5px);
        }
        
        .sidebar-menu a .icon {
            width: 20px; margin-right: 15px; font-size: 16px;
            display: flex; align-items: center; justify-content: center;
        }
        
        .sidebar-menu a .menu-text {
            position: relative; z-index: 1;
        }
        
        .main-content {
            margin-left: 280px; min-height: 100vh; 
            background: var(--card-bg); backdrop-filter: blur(10px);
            transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .main-content.expanded { margin-left: 40px; }
        
        .topbar {
            background: rgba(255,255,255,0.95); backdrop-filter: blur(20px);
            padding: 15px 30px; box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--border-color); position: sticky; top: 0; z-index: 100;
        }
        
        .topbar-left {
            display: flex; align-items: center; gap: 20px;
        }
        
        .toggle-sidebar {
            background: #f8fafc; border: none; padding: 10px 12px;
            border-radius: 10px; cursor: pointer; font-size: 16px;
            transition: all 0.3s ease; color: var(--text-primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .toggle-sidebar:hover { 
            background: #e2e8f0; transform: scale(1.05);
        }
        
        .breadcrumb {
            display: flex; align-items: center; gap: 8px; font-size: 14px;
            color: var(--text-secondary); font-weight: 500;
        }
        
        .breadcrumb i {
            font-size: 12px;
        }
        
        .topbar-right {
            display: flex; align-items: center; gap: 20px;
        }
        
        .device-selector {
            display: flex; align-items: center; gap: 12px;
            background: rgba(37, 211, 102, 0.1); padding: 10px 16px; 
            border-radius: 12px; border: 2px solid rgba(37, 211, 102, 0.2);
            transition: all 0.3s ease;
        }
        
        .device-selector:hover {
            background: rgba(37, 211, 102, 0.15);
            border-color: rgba(37, 211, 102, 0.3);
        }
        
        .device-selector i {
            color: var(--whatsapp-primary); font-size: 16px;
        }
        
        .device-selector select {
            border: none; background: transparent; font-size: 14px;
            color: var(--text-primary); font-weight: 500; cursor: pointer;
            outline: none; min-width: 200px;
        }
        
        .status-indicator {
            display: flex; align-items: center; gap: 8px;
            background: rgba(16, 185, 129, 0.1); padding: 8px 12px;
            border-radius: 20px; font-size: 12px; font-weight: 600;
            color: var(--success-color);
        }
        
        .status-dot {
            width: 8px; height: 8px; border-radius: 50%;
            background: var(--success-color); animation: pulse 2s infinite;
        }
        
        .current-time {
            font-size: 13px; color: var(--text-secondary); font-weight: 500;
            background: #f8fafc; padding: 8px 12px; border-radius: 8px;
        }
        
        .content-area {
            padding: 30px;
        }
        
        .page-header {
            margin-bottom: 30px; display: flex; justify-content: space-between; 
            align-items: center; flex-wrap: wrap; gap: 20px;
        }
        
        .page-title {
            display: flex; align-items: center; gap: 15px;
        }
        
        .page-title i {
            width: 50px; height: 50px; background: linear-gradient(135deg, var(--whatsapp-primary) 0%, var(--whatsapp-secondary) 100%);
            border-radius: 15px; display: flex; align-items: center; justify-content: center;
            color: white; font-size: 20px; box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
        }
        
        .page-title h1 {
            color: var(--text-primary); font-size: 28px; font-weight: 700; margin: 0;
        }
        
        .page-section {
            display: none; animation: fadeIn 0.5s ease-in-out;
        }
        
        .page-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .stats-grid {
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px; margin-bottom: 40px;
        }
        
        .stat-card {
            background: white; padding: 30px; border-radius: 20px;
            box-shadow: 0 4px 25px rgba(0,0,0,0.08);
            border: 1px solid var(--border-color); position: relative; overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .stat-card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0;
            height: 4px; background: linear-gradient(90deg, var(--whatsapp-primary), var(--whatsapp-secondary));
        }
        
        .stat-card:hover {
            transform: translateY(-8px); box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }
        
        .stat-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .stat-title {
            font-size: 13px; font-weight: 600; color: var(--text-secondary);
            text-transform: uppercase; letter-spacing: 1px;
        }
        
        .stat-icon {
            width: 45px; height: 45px; background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
        }
        
        .stat-icon i {
            font-size: 20px; color: var(--text-primary);
        }
        
        .stat-value {
            font-size: 36px; font-weight: 800; color: var(--text-primary);
            margin-bottom: 12px; line-height: 1;
        }
        
        .stat-change {
            font-size: 13px; display: flex; align-items: center; gap: 6px;
            font-weight: 500;
        }
        
        .stat-change.positive { color: var(--success-color); }
        .stat-change.negative { color: var(--danger-color); }
        .stat-change.neutral { color: var(--text-secondary); }
        
        .devices-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 25px; margin-bottom: 30px;
        }
        
        .device-card {
            background: white; border-radius: 20px; padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid var(--border-color); position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }
        
        .device-card::before {
            content: ''; position: absolute; top: 0; right: 0;
            width: 100px; height: 100px; background: radial-gradient(circle, rgba(37, 211, 102, 0.1) 0%, transparent 70%);
        }
        
        .device-card:hover {
            transform: translateY(-5px); box-shadow: 0 12px 35px rgba(0,0,0,0.15);
        }
        
        .device-status {
            position: absolute; top: 20px; right: 20px;
            width: 14px; height: 14px; border-radius: 50%;
            box-shadow: 0 0 0 3px rgba(255,255,255,0.8);
        }
        
        .device-status.online { 
            background: var(--success-color); 
            animation: pulse 2s infinite;
        }
        .device-status.offline { 
            background: var(--danger-color); 
            animation: none; 
        }
        .device-status.connecting { 
            background: var(--warning-color); 
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }
        
        .device-header {
            display: flex; align-items: center; gap: 15px; margin-bottom: 20px;
        }
        
        .device-avatar {
            width: 55px; height: 55px; background: linear-gradient(135deg, var(--whatsapp-primary) 0%, var(--whatsapp-secondary) 100%);
            border-radius: 15px; display: flex; align-items: center; justify-content: center;
            color: white; font-size: 20px; box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
        }
        
        .device-info h3 {
            font-size: 18px; font-weight: 600; color: var(--text-primary);
            margin-bottom: 4px; display: flex; align-items: center; gap: 10px;
        }
        
        .device-phone {
            font-size: 13px; color: var(--text-secondary); font-weight: 500;
        }
        
        .active-badge {
            font-size: 10px; background: var(--success-color); color: white; 
            padding: 3px 8px; border-radius: 10px; margin-left: 8px;
            font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;
        }
        
        .device-meta {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
            margin: 20px 0; font-size: 13px;
        }
        
        .device-meta-item {
            background: #f8fafc; padding: 12px 15px; border-radius: 12px;
            border: 1px solid #f1f5f9;
        }
        
        .device-meta-label {
            color: var(--text-secondary); font-weight: 500; margin-bottom: 4px;
            display: flex; align-items: center; gap: 6px;
        }
        
        .device-meta-value {
            color: var(--text-primary); font-weight: 600;
        }
        
        .device-actions {
            display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 16px; border-radius: 10px; border: none;
            font-size: 13px; font-weight: 600; cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            text-decoration: none; display: inline-flex; 
            align-items: center; gap: 8px; position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.2); transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        
        .btn:hover::before {
            transform: translateX(0);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--info-color) 0%, #2563eb 100%);
            color: white; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px); box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success-color) 0%, #059669 100%);
            color: white; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        .btn-success:hover {
            transform: translateY(-2px); box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color) 0%, #dc2626 100%);
            color: white; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }
        
        .btn-danger:hover {
            transform: translateY(-2px); box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }
        
        .btn-secondary {
            background: #f1f5f9; color: var(--text-secondary);
            border: 1px solid #e2e8f0;
        }
        
        .btn-secondary:hover {
            background: #e2e8f0; transform: translateY(-1px);
        }
        
        .btn-whatsapp {
            background: linear-gradient(135deg, var(--whatsapp-primary) 0%, var(--whatsapp-secondary) 100%);
            color: white; box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
        }
        
        .btn-whatsapp:hover {
            transform: translateY(-2px); box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
        }
        
        .form-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 30px;
            margin-top: 30px;
        }
        
        .form-section {
            background: white; padding: 30px; border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid var(--border-color);
        }
        
        .form-section-header {
            display: flex; align-items: center; gap: 12px;
            margin-bottom: 25px; padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .form-section-icon {
            width: 40px; height: 40px; background: linear-gradient(135deg, var(--whatsapp-primary) 0%, var(--whatsapp-secondary) 100%);
            border-radius: 10px; display: flex; align-items: center; justify-content: center;
            color: white; font-size: 16px;
        }
        
        .form-section h3 {
            font-size: 18px; font-weight: 600; color: var(--text-primary); margin: 0;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block; font-weight: 600; color: var(--text-primary);
            margin-bottom: 8px; font-size: 14px;
        }
        
        .form-control {
            width: 100%; padding: 12px 16px; border: 2px solid var(--border-color);
            border-radius: 12px; font-size: 14px; 
            transition: all 0.3s ease; background: white;
            font-family: inherit;
        }
        
        .form-control:focus {
            outline: none; border-color: var(--whatsapp-primary);
            box-shadow: 0 0 0 3px rgba(37, 211, 102, 0.1);
        }
        
        .form-control.textarea {
            min-height: 120px; resize: vertical; font-family: inherit;
        }
        
        .input-group {
            position: relative;
        }
        
        .input-group i {
            position: absolute; left: 15px; top: 50%; transform: translateY(-50%);
            color: var(--text-secondary); font-size: 14px;
        }
        
        .input-group .form-control {
            padding-left: 45px;
        }
        
        .activity-feed {
            background: white; border-radius: 20px; padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-top: 30px;
            border: 1px solid var(--border-color);
        }
        
        .activity-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 25px; padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .activity-header h3 {
            font-size: 18px; font-weight: 600; color: var(--text-primary);
            display: flex; align-items: center; gap: 10px;
        }
        
        .activity-item {
            display: flex; align-items: start; gap: 15px;
            padding: 18px 0; border-bottom: 1px solid #f8fafc;
        }
        
        .activity-item:last-child { border-bottom: none; }
        
        .activity-icon {
            width: 45px; height: 45px; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 16px; color: white; flex-shrink: 0;
        }
        
        .activity-icon.success { background: linear-gradient(135deg, var(--success-color) 0%, #059669 100%); }
        .activity-icon.error { background: linear-gradient(135deg, var(--danger-color) 0%, #dc2626 100%); }
        .activity-icon.info { background: linear-gradient(135deg, var(--info-color) 0%, #2563eb 100%); }
        .activity-icon.warning { background: linear-gradient(135deg, var(--warning-color) 0%, #d97706 100%); }
        
        .activity-content h4 {
            font-size: 14px; font-weight: 600; color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .activity-content p {
            font-size: 13px; color: var(--text-secondary); line-height: 1.5;
            margin: 0;
        }
        
        .activity-time {
            font-size: 11px; color: #94a3b8; margin-left: auto;
            flex-shrink: 0; font-weight: 500;
        }
        
        .metrics-row {
            display: grid; grid-template-columns: 2fr 1fr; gap: 30px;
            margin-top: 30px;
        }
        
        .chart-container {
            background: white; padding: 30px; border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid var(--border-color);
        }
        
        .chart-header {
            display: flex; align-items: center; gap: 12px;
            margin-bottom: 25px; padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .chart-icon {
            width: 40px; height: 40px; background: linear-gradient(135deg, var(--info-color) 0%, #2563eb 100%);
            border-radius: 10px; display: flex; align-items: center; justify-content: center;
            color: white; font-size: 16px;
        }
        
        .notifications {
            position: fixed; top: 20px; right: 20px; z-index: 10000;
            max-width: 400px;
        }
        
        .notification {
            background: white; padding: 18px 20px; border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15); margin-bottom: 12px;
            border-left: 4px solid var(--info-color); min-width: 320px;
            transform: translateX(100%); animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            backdrop-filter: blur(10px);
        }
        
        .notification.success { border-left-color: var(--success-color); }
        .notification.error { border-left-color: var(--danger-color); }
        .notification.warning { border-left-color: var(--warning-color); }
        
        .notification.hide {
            animation: slideOut 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        
        .notification-header {
            display: flex; align-items: center; gap: 10px; margin-bottom: 6px;
        }
        
        .notification-icon {
            font-size: 18px;
        }
        
        .notification-title {
            font-weight: 600; font-size: 14px; color: var(--text-primary);
        }
        
        .notification-message {
            font-size: 13px; color: var(--text-secondary); margin: 0;
            line-height: 1.4;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        .loading {
            display: inline-block; width: 20px; height: 20px;
            border: 2px solid #f3f3f3; border-top: 2px solid var(--whatsapp-primary);
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .empty-state {
            text-align: center; padding: 80px 20px; color: var(--text-secondary);
        }
        
        .empty-state .icon {
            font-size: 64px; margin-bottom: 20px; opacity: 0.4;
            color: var(--text-secondary);
        }
        
        .empty-state h3 {
            font-size: 20px; margin-bottom: 10px; color: var(--text-primary);
            font-weight: 600;
        }
        
        .empty-state p {
            font-size: 14px; line-height: 1.6; max-width: 400px;
            margin: 0 auto 20px;
        }
        
        .terminal-container {
            background: #0d1117; border-radius: 15px; padding: 25px; 
            color: #e6edf3; font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace; 
            font-size: 13px; line-height: 1.7; max-height: 600px; overflow-y: auto;
            border: 1px solid #21262d;
        }
        
        .terminal-header {
            color: var(--success-color); margin-bottom: 15px; font-weight: 600;
            display: flex; align-items: center; gap: 10px;
        }
        
        .terminal-divider {
            color: #30363d; margin-bottom: 20px; font-weight: 300;
        }
        
        .log-entry {
            margin-bottom: 6px; padding: 4px 0;
        }
        
        .log-timestamp {
            color: #7d8590; margin-right: 8px;
        }
        
        .log-level {
            margin-right: 8px; padding: 2px 6px; border-radius: 4px;
            font-size: 11px; font-weight: 600;
        }
        
        .log-level.error { background: #da3633; color: white; }
        .log-level.warn { background: #fb8500; color: white; }
        .log-level.success { background: #238636; color: white; }
        .log-level.info { background: #1f6feb; color: white; }
        .log-level.security { background: #8b5cf6; color: white; }
        
        .quick-actions {
            display: flex; gap: 15px; flex-wrap: wrap; margin-top: 25px;
        }
        
        .whatsapp-qr {
            background: white; padding: 30px; border-radius: 20px;
            text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid var(--border-color);
        }
        
        .qr-placeholder {
            width: 250px; height: 250px; margin: 0 auto 20px;
            background: #f8fafc; border-radius: 15px;
            display: flex; align-items: center; justify-content: center;
            color: var(--text-secondary); font-size: 48px;
            border: 2px dashed #e2e8f0;
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .form-grid { grid-template-columns: 1fr; }
            .metrics-row { grid-template-columns: 1fr; }
        }
        
        @media (max-width: 768px) {
            .sidebar { 
                transform: translateX(-100%); width: 100%; 
            }
            .sidebar.mobile-open { transform: translateX(0); }
            .main-content { margin-left: 0; }
            .main-content.expanded { margin-left: 0; }
            .stats-grid { grid-template-columns: 1fr; }
            .devices-grid { grid-template-columns: 1fr; }
            .topbar { padding: 15px 20px; }
            .content-area { padding: 20px; }
            .page-header { flex-direction: column; align-items: flex-start; }
        }
        
        @media (max-width: 480px) {
            .device-actions { flex-direction: column; }
            .device-meta { grid-template-columns: 1fr; }
            .notification { min-width: 280px; }
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            .form-control { background: #f8fafc; }
            .terminal-container { background: #0d1117; }
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        /* Custom animations */
        .bounce-in {
            animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Notifications Container -->
    <div class="notifications" id="notifications"></div>
    
    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo-container">
                <div class="whatsapp-logo">
                    <i class="fab fa-whatsapp"></i>
                </div>
                <div class="brand-text">
                    <h2>WhatsApp Hub</h2>
                    <div class="subtitle">Multi-Device Manager</div>
                </div>
            </div>
        </div>
        
        <ul class="sidebar-menu">
            <li><a href="#" class="menu-link active" data-page="dashboard">
                <span class="icon"><i class="fas fa-chart-pie"></i></span>
                <span class="menu-text">Dashboard</span>
            </a></li>
            <li><a href="#" class="menu-link" data-page="devices">
                <span class="icon"><i class="fas fa-mobile-alt"></i></span>
                <span class="menu-text">Device Management</span>
            </a></li>
            <li><a href="#" class="menu-link" data-page="messaging">
                <span class="icon"><i class="fas fa-comment-dots"></i></span>
                <span class="menu-text">Send Messages</span>
            </a></li>
            <li><a href="#" class="menu-link" data-page="bulk">
                <span class="icon"><i class="fas fa-paper-plane"></i></span>
                <span class="menu-text">Bulk Messaging</span>
            </a></li>
            <li><a href="#" class="menu-link" data-page="automation">
                <span class="icon"><i class="fas fa-robot"></i></span>
                <span class="menu-text">Automation</span>
            </a></li>
            <li><a href="#" class="menu-link" data-page="analytics">
                <span class="icon"><i class="fas fa-chart-line"></i></span>
                <span class="menu-text">Analytics</span>
            </a></li>
            <li><a href="#" class="menu-link" data-page="logs">
                <span class="icon"><i class="fas fa-terminal"></i></span>
                <span class="menu-text">System Logs</span>
            </a></li>
            <li><a href="#" class="menu-link" data-page="settings">
                <span class="icon"><i class="fas fa-cog"></i></span>
                <span class="menu-text">Settings</span>
            </a></li>
        </ul>
    </nav>
    
    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <!-- Top Bar -->
        <div class="topbar">
            <div class="topbar-left">
                <button class="toggle-sidebar" id="toggleSidebar">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="breadcrumb">
                    <i class="fas fa-home"></i>
                    <span id="currentPageBreadcrumb">Dashboard</span>
                </div>
            </div>
            <div class="topbar-right">
                <div class="device-selector">
                    <i class="fab fa-whatsapp"></i>
                    <select id="activeDeviceSelector">
                        <option value="">Select Active Device</option>
                    </select>
                </div>
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span>Online</span>
                </div>
                <div class="current-time">
                    <i class="fas fa-clock" style="margin-right: 6px;"></i>
                    <span id="currentTime"></span>
                </div>
            </div>
        </div>
        
        <!-- Content Area -->
        <div class="content-area">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page-section active">
                <div class="page-header">
                    <div class="page-title">
                        <i class="fas fa-chart-pie"></i>
                        <h1>Dashboard Overview</h1>
                    </div>
                    <div class="quick-actions">
                        <button class="btn btn-whatsapp" onclick="addNewDevice()">
                            <i class="fas fa-plus"></i> Add Device
                        </button>
                        <button class="btn btn-secondary" onclick="refreshDashboard()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>
                
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Connected Devices</span>
                            <div class="stat-icon">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="connectedDevicesCount">0</div>
                        <div class="stat-change neutral" id="devicesChange">
                            <i class="fas fa-minus"></i> No changes
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Messages Today</span>
                            <div class="stat-icon">
                                <i class="fas fa-comment"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="messagesToday">0</div>
                        <div class="stat-change positive" id="messagesChange">
                            <i class="fas fa-arrow-up"></i> +0% from yesterday
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Success Rate</span>
                            <div class="stat-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="successRate">0%</div>
                        <div class="stat-change positive" id="successChange">
                            <i class="fas fa-heart"></i> Healthy
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Active Automations</span>
                            <div class="stat-icon">
                                <i class="fas fa-robot"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="activeAutomations">0</div>
                        <div class="stat-change neutral" id="automationChange">
                            <i class="fas fa-minus"></i> Stable
                        </div>
                    </div>
                </div>
                
                <!-- Metrics Row -->
                <div class="metrics-row">
                    <div class="chart-container">
                        <div class="chart-header">
                            <div class="chart-icon">
                                <i class="fas fa-chart-area"></i>
                            </div>
                            <h3>Message Analytics</h3>
                        </div>
                        <div id="messageChart" style="height: 300px; display: flex; align-items: center; justify-content: center; color: var(--text-secondary);">
                            <div style="text-align: center;">
                                <i class="fas fa-chart-line" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;"></i>
                                <p>Chart will be loaded here</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="activity-feed">
                        <div class="activity-header">
                            <h3>
                                <i class="fas fa-bolt"></i>
                                Recent Activity
                            </h3>
                            <button class="btn btn-secondary" onclick="refreshActivity()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                        <div id="activityList">
                            <div class="empty-state">
                                <div class="icon">
                                    <i class="fas fa-inbox"></i>
                                </div>
                                <h3>No Recent Activity</h3>
                                <p>Activity will appear here when devices are connected</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Device Management Page -->
            <div id="devices" class="page-section">
                <div class="page-header">
                    <div class="page-title">
                        <i class="fas fa-mobile-alt"></i>
                        <h1>Device Management</h1>
                    </div>
                    <div class="quick-actions">
                        <button class="btn btn-whatsapp" onclick="addNewDevice()">
                            <i class="fas fa-plus"></i> Add Device
                        </button>
                        <button class="btn btn-secondary" onclick="refreshDevices()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                        <button class="btn btn-danger" onclick="disconnectAllDevices()">
                            <i class="fas fa-power-off"></i> Disconnect All
                        </button>
                    </div>
                </div>
                
                <div class="devices-grid" id="devicesGrid">
                    <!-- Devices will be loaded here -->
                </div>
            </div>
            
            <!-- Messaging Page -->
            <div id="messaging" class="page-section">
                <div class="page-header">
                    <div class="page-title">
                        <i class="fas fa-comment-dots"></i>
                        <h1>Send Messages</h1>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-section">
                        <div class="form-section-header">
                            <div class="form-section-icon">
                                <i class="fas fa-paper-plane"></i>
                            </div>
                            <h3>Quick Message</h3>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <i class="fas fa-mobile-alt" style="margin-right: 6px;"></i>
                                Select Device
                            </label>
                            <select class="form-control" id="messageDeviceSelector">
                                <option value="">Choose active device</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <i class="fas fa-phone" style="margin-right: 6px;"></i>
                                Phone Number
                            </label>
                            <div class="input-group">
                                <i class="fas fa-phone"></i>
                                <input type="tel" class="form-control" id="quickPhone" placeholder="+91 98765 43210">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <i class="fas fa-comment" style="margin-right: 6px;"></i>
                                Message
                            </label>
                            <textarea class="form-control textarea" id="quickMessage" placeholder="Type your message here..."></textarea>
                        </div>
                        
                        <button class="btn btn-whatsapp" onclick="sendQuickMessage()">
                            <i class="fab fa-whatsapp"></i> Send Message
                        </button>
                    </div>
                    
                    <div class="form-section">
                        <div class="form-section-header">
                            <div class="form-section-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <h3>Message Templates</h3>
                        </div>
                        
                        <div id="templatesList">
                            <div class="empty-state">
                                <div class="icon">
                                    <i class="fas fa-file-plus"></i>
                                </div>
                                <h3>No Templates</h3>
                                <p>Create templates for quick messaging</p>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <div class="input-group" style="margin-bottom: 10px;">
                                <i class="fas fa-tag"></i>
                                <input type="text" class="form-control" id="templateName" placeholder="Template name">
                            </div>
                            <textarea class="form-control textarea" id="templateContent" placeholder="Template content"></textarea>
                            <button class="btn btn-primary" onclick="addTemplate()" style="margin-top: 10px;">
                                <i class="fas fa-plus"></i> Add Template
                            </button>
                                                    </div>
                    </div>
                </div>
            </div>
            
            <!-- Bulk Messaging Page -->
            <div id="bulk" class="page-section">
                <div class="page-header">
                    <div class="page-title">
                        <i class="fas fa-paper-plane"></i>
                        <h1>Bulk Messaging</h1>
                    </div>
                </div>
                
                <div class="form-section" style="max-width: 100%;">
                    <div class="form-grid">
                        <div>
                            <div class="form-section-header">
                                <div class="form-section-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <h3>Recipients</h3>
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <i class="fas fa-mobile-alt" style="margin-right: 6px;"></i>
                                    Select Device
                                </label>
                                <select class="form-control" id="bulkDeviceSelector">
                                    <option value="">Choose active device</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <i class="fas fa-list" style="margin-right: 6px;"></i>
                                    Phone Numbers (one per line)
                                </label>
                                <textarea class="form-control textarea" id="bulkNumbers" placeholder="919876543210&#10;919876543211&#10;919876543212" style="height: 200px;"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <i class="fas fa-file-csv" style="margin-right: 6px;"></i>
                                    Or Upload CSV File
                                </label>
                                <input type="file" class="form-control" id="csvUpload" accept=".csv,.txt" onchange="handleCSVUpload(event)">
                                <small style="color: var(--text-secondary); display: block; margin-top: 6px;">
                                    <i class="fas fa-info-circle"></i> Upload a CSV or TXT file with phone numbers
                                </small>
                            </div>
                        </div>
                        
                        <div>
                            <div class="form-section-header">
                                <div class="form-section-icon">
                                    <i class="fas fa-envelope"></i>
                                </div>
                                <h3>Message Content</h3>
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <i class="fas fa-comment-alt" style="margin-right: 6px;"></i>
                                    Message
                                </label>
                                <textarea class="form-control textarea" id="bulkMessage" placeholder="Your bulk message content..." style="height: 200px;"></textarea>
                                <small style="color: var(--text-secondary); display: block; margin-top: 6px;">
                                    <i class="fas fa-info-circle"></i> Use {name} for personalization
                                </small>
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <i class="fas fa-clock" style="margin-right: 6px;"></i>
                                    Send Delay (seconds)
                                </label>
                                <div class="input-group">
                                    <i class="fas fa-hourglass-half"></i>
                                    <input type="number" class="form-control" id="bulkDelay" value="5" min="3" max="60">
                                </div>
                                <small style="color: var(--text-secondary); display: block; margin-top: 6px;">
                                    <i class="fas fa-shield-alt"></i> Minimum 3 seconds recommended to avoid blocks
                                </small>
                            </div>
                            
                            <button class="btn btn-whatsapp" onclick="sendBulkMessage()" style="width: 100%; padding: 14px;">
                                <i class="fas fa-paper-plane"></i> Start Bulk Send
                            </button>
                        </div>
                    </div>
                    
                    <div id="bulkProgress" style="display: none; margin-top: 30px; padding: 25px; background: #f8fafc; border-radius: 15px; border: 1px solid var(--border-color);">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div class="loading"></div>
                            <div>
                                <strong style="color: var(--text-primary); font-size: 15px;">Sending in progress...</strong>
                                <p style="margin: 4px 0 0 0; font-size: 13px; color: var(--text-secondary);">
                                    <span id="progressText">0 / 0 sent</span>
                                </p>
                            </div>
                        </div>
                        <div style="background: #e2e8f0; height: 8px; border-radius: 10px; overflow: hidden;">
                            <div id="progressBar" style="background: linear-gradient(90deg, var(--whatsapp-primary), var(--whatsapp-secondary)); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Automation Page -->
            <div id="automation" class="page-section">
                <div class="page-header">
                    <div class="page-title">
                        <i class="fas fa-robot"></i>
                        <h1>Automation Settings</h1>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-section">
                        <div class="form-section-header">
                            <div class="form-section-icon">
                                <i class="fas fa-reply"></i>
                            </div>
                            <h3>Auto-Reply</h3>
                        </div>
                        
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="autoReplyEnabled" style="width: 20px; height: 20px; cursor: pointer;">
                                <span><i class="fas fa-toggle-on" style="margin-right: 6px; color: var(--whatsapp-primary);"></i>Enable Auto-Reply</span>
                            </label>
                            <small style="color: var(--text-secondary); display: block; margin-top: 6px; margin-left: 30px;">
                                Automatically respond to incoming messages
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <i class="fas fa-comment-dots" style="margin-right: 6px;"></i>
                                Reply Message
                            </label>
                            <textarea class="form-control textarea" id="autoReplyText" placeholder="Thank you for your message. We'll get back to you soon!"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <i class="fas fa-stopwatch" style="margin-right: 6px;"></i>
                                Reply Delay (seconds)
                            </label>
                            <div class="input-group">
                                <i class="fas fa-hourglass-start"></i>
                                <input type="number" class="form-control" id="autoReplyDelay" value="3" min="1" max="60">
                            </div>
                        </div>
                        
                        <button class="btn btn-success" onclick="saveAutomationSettings()">
                            <i class="fas fa-save"></i> Save Auto-Reply Settings
                        </button>
                    </div>
                    
                    <div class="form-section">
                        <div class="form-section-header">
                            <div class="form-section-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <h3>Scheduled Messages</h3>
                        </div>
                        
                        <div id="scheduledMessagesList" style="max-height: 300px; overflow-y: auto; margin-bottom: 20px;">
                            <div class="empty-state">
                                <div class="icon">
                                    <i class="fas fa-calendar-plus"></i>
                                </div>
                                <h3>No Scheduled Messages</h3>
                                <p>Schedule messages for future delivery</p>
                            </div>
                        </div>
                        
                        <div style="background: #f8fafc; padding: 20px; border-radius: 12px; border: 1px solid var(--border-color);">
                            <h4 style="margin-bottom: 15px; font-size: 14px; font-weight: 600;">
                                <i class="fas fa-plus-circle" style="margin-right: 6px; color: var(--whatsapp-primary);"></i>
                                Add Scheduled Message
                            </h4>
                            <div class="input-group" style="margin-bottom: 10px;">
                                <i class="fas fa-phone"></i>
                                <input type="tel" class="form-control" id="schedulePhone" placeholder="Phone number">
                            </div>
                            <textarea class="form-control" id="scheduleMessage" placeholder="Message content" style="margin-bottom: 10px; height: 80px;"></textarea>
                            <div class="input-group" style="margin-bottom: 10px;">
                                <i class="fas fa-calendar"></i>
                                <input type="datetime-local" class="form-control" id="scheduleDateTime">
                            </div>
                            <button class="btn btn-primary" onclick="scheduleMessage()" style="width: 100%;">
                                <i class="fas fa-clock"></i> Schedule Message
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Analytics Page -->
            <div id="analytics" class="page-section">
                <div class="page-header">
                    <div class="page-title">
                        <i class="fas fa-chart-line"></i>
                        <h1>Analytics & Reports</h1>
                    </div>
                    <div class="quick-actions">
                        <button class="btn btn-primary" onclick="exportAnalytics()">
                            <i class="fas fa-download"></i> Export Report
                        </button>
                        <button class="btn btn-secondary" onclick="refreshAnalytics()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Total Sent</span>
                            <div class="stat-icon">
                                <i class="fas fa-paper-plane"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="totalSent">0</div>
                        <div class="stat-change" id="totalSentChange">
                            <i class="fas fa-arrow-up"></i> +0% from last week
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Total Received</span>
                            <div class="stat-icon">
                                <i class="fas fa-inbox"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="totalReceived">0</div>
                        <div class="stat-change" id="totalReceivedChange">
                            <i class="fas fa-arrow-up"></i> +0% from last week
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">Failed Messages</span>
                            <div class="stat-icon">
                                <i class="fas fa-exclamation-circle"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="totalFailed">0</div>
                        <div class="stat-change" id="totalFailedChange">
                            <i class="fas fa-arrow-down"></i> -0% from last week
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-title">System Uptime</span>
                            <div class="stat-icon">
                                <i class="fas fa-server"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="systemUptime" style="font-size: 24px;">0h</div>
                        <div class="stat-change positive">
                            <i class="fas fa-check-circle"></i> Running smoothly
                        </div>
                    </div>
                </div>
                
                <div class="chart-container" style="margin-top: 30px;">
                    <div class="chart-header">
                        <div class="chart-icon">
                            <i class="fas fa-chart-area"></i>
                        </div>
                        <h3>Message Trends (Last 7 Days)</h3>
                    </div>
                    <div id="analyticsChart" style="height: 400px; display: flex; align-items: center; justify-content: center; color: var(--text-secondary);">
                        <div style="text-align: center;">
                            <i class="fas fa-chart-bar" style="font-size: 64px; margin-bottom: 20px; opacity: 0.3;"></i>
                            <h3 style="margin-bottom: 10px; color: var(--text-primary);">Detailed Analytics</h3>
                            <p>Comprehensive analytics chart will be displayed here</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- System Logs Page -->
            <div id="logs" class="page-section">
                <div class="page-header">
                    <div class="page-title">
                        <i class="fas fa-terminal"></i>
                        <h1>System Logs</h1>
                    </div>
                    <div class="quick-actions">
                        <button class="btn btn-secondary" onclick="refreshLogs()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                        <button class="btn btn-primary" onclick="downloadLogs()">
                            <i class="fas fa-download"></i> Download
                        </button>
                        <button class="btn btn-danger" onclick="clearLogs()">
                            <i class="fas fa-trash-alt"></i> Clear Logs
                        </button>
                    </div>
                </div>
                
                <div class="terminal-container" id="terminalLogs">
                    <div class="terminal-header">
                        <i class="fas fa-rocket"></i>
                        WhatsApp Multi-Device Hub - Live System Logs
                    </div>
                    <div class="terminal-divider">
                        
                    </div>
                    <div id="logEntries">
                        <div style="color: #7d8590;">
                            <span class="log-timestamp">[--:--:--]</span>
                            <span class="log-level info">SYSTEM</span>
                            Waiting for log entries...
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Settings Page -->
            <div id="settings" class="page-section">
                <div class="page-header">
                    <div class="page-title">
                        <i class="fas fa-cog"></i>
                        <h1>System Settings</h1>
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-section">
                        <div class="form-section-header">
                            <div class="form-section-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <h3>Security Settings</h3>
                        </div>
                        
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="safeMode" style="width: 20px; height: 20px; cursor: pointer;">
                                <span><i class="fas fa-lock" style="margin-right: 6px; color: var(--success-color);"></i>Enable Safe Mode</span>
                            </label>
                            <small style="color: var(--text-secondary); display: block; margin-top: 6px; margin-left: 30px;">
                                Conservative sending limits to prevent account bans
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <i class="fas fa-calendar-day" style="margin-right: 6px;"></i>
                                Daily Send Limit
                            </label>
                            <div class="input-group">
                                <i class="fas fa-hashtag"></i>
                                <input type="number" class="form-control" id="dailyLimit" value="100" min="1" max="1000">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <i class="fas fa-hourglass" style="margin-right: 6px;"></i>
                                Hourly Send Limit
                            </label>
                            <div class="input-group">
                                <i class="fas fa-hashtag"></i>
                                <input type="number" class="form-control" id="hourlyLimit" value="20" min="1" max="100">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <i class="fas fa-clock" style="margin-right: 6px;"></i>
                                Min Send Delay (seconds)
                            </label>
                            <div class="input-group">
                                <i class="fas fa-stopwatch"></i>
                                <input type="number" class="form-control" id="minDelay" value="3" min="1" max="60">
                            </div>
                        </div>
                        
                        <button class="btn btn-success" onclick="saveSettings()">
                            <i class="fas fa-save"></i> Save Security Settings
                        </button>
                    </div>
                    
                    <div class="form-section">
                        <div class="form-section-header">
                            <div class="form-section-icon">
                                <i class="fas fa-tools"></i>
                            </div>
                            <h3>System Controls</h3>
                        </div>
                        
                        <div class="quick-actions" style="flex-direction: column; gap: 12px;">
                            <button class="btn btn-primary" onclick="downloadBackup()" style="width: 100%; justify-content: center;">
                                <i class="fas fa-cloud-download-alt"></i> Download Backup
                            </button>
                            <button class="btn btn-secondary" onclick="restoreBackup()" style="width: 100%; justify-content: center;">
                                <i class="fas fa-cloud-upload-alt"></i> Restore Backup
                            </button>
                            <button class="btn btn-warning" onclick="restartSystem()" style="width: 100%; justify-content: center; background: linear-gradient(135deg, var(--warning-color), #d97706);">
                                <i class="fas fa-redo-alt"></i> Restart System
                            </button>
                            <button class="btn btn-danger" onclick="logoutAllDevices()" style="width: 100%; justify-content: center;">
                                <i class="fas fa-sign-out-alt"></i> Logout All Devices
                            </button>
                        </div>
                        
                        <div style="margin-top: 30px; background: #f8fafc; padding: 20px; border-radius: 12px; border: 1px solid var(--border-color);">
                            <h4 style="margin-bottom: 15px; font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-info-circle" style="color: var(--info-color);"></i>
                                System Status
                            </h4>
                            <div style="font-size: 13px; line-height: 2;">
                                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e2e8f0;">
                                    <span style="color: var(--text-secondary); display: flex; align-items: center; gap: 6px;">
                                        <i class="fas fa-circle" style="font-size: 8px;"></i>
                                        Server Status:
                                    </span>
                                    <span style="color: var(--success-color); font-weight: 600;">
                                        <i class="fas fa-check-circle"></i> Online
                                    </span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e2e8f0;">
                                    <span style="color: var(--text-secondary); display: flex; align-items: center; gap: 6px;">
                                        <i class="fas fa-circle" style="font-size: 8px;"></i>
                                        Active Connections:
                                    </span>
                                    <span style="font-weight: 600; color: var(--text-primary);" id="activeConnections">0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e2e8f0;">
                                    <span style="color: var(--text-secondary); display: flex; align-items: center; gap: 6px;">
                                        <i class="fas fa-circle" style="font-size: 8px;"></i>
                                        Memory Usage:
                                    </span>
                                    <span style="font-weight: 600; color: var(--text-primary);" id="memoryUsage">N/A</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 8px 0;">
                                    <span style="color: var(--text-secondary); display: flex; align-items: center; gap: 6px;">
                                        <i class="fas fa-circle" style="font-size: 8px;"></i>
                                        Last Updated:
                                    </span>
                                    <span style="font-weight: 600; color: var(--text-primary);" id="lastUpdated">Just now</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.1)); border-radius: 12px; border: 1px solid rgba(59, 130, 246, 0.2);">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                <i class="fas fa-code" style="color: var(--info-color); font-size: 16px;"></i>
                                <strong style="font-size: 13px; color: var(--text-primary);">API Endpoint</strong>
                            </div>
                            <code style="font-size: 12px; color: var(--text-secondary); word-break: break-all; background: rgba(255,255,255,0.7); padding: 8px; border-radius: 6px; display: block;">
                                http://localhost:3000/api
                            </code>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Global variables
        let currentPage = 'dashboard';
        let devices = [];
        let refreshInterval;
        let logInterval;
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            setupEventListeners();
            loadInitialData();
            startRealTimeUpdates();
        });
        
        // Initialize
        function initializeDashboard() {
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            
            const now = new Date();
            now.setMinutes(now.getMinutes() + 1);
            document.getElementById('scheduleDateTime').min = now.toISOString().slice(0, 16);
        }
        
        // Event listeners
        function setupEventListeners() {
            document.getElementById('toggleSidebar').addEventListener('click', toggleSidebar);
            
            document.querySelectorAll('.menu-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    navigateToPage(page);
                });
            });
            
            document.getElementById('activeDeviceSelector').addEventListener('change', handleDeviceChange);
        }
        
        // Navigation
        function navigateToPage(page) {
            document.querySelectorAll('.menu-link').forEach(link => link.classList.remove('active'));
            document.querySelector(`[data-page="${page}"]`).classList.add('active');
            
            document.querySelectorAll('.page-section').forEach(section => section.classList.remove('active'));
            document.getElementById(page).classList.add('active');
            
            // Update breadcrumb
            const pageNames = {
                dashboard: 'Dashboard',
                devices: 'Device Management',
                messaging: 'Send Messages',
                bulk: 'Bulk Messaging',
                automation: 'Automation',
                analytics: 'Analytics',
                logs: 'System Logs',
                settings: 'Settings'
            };
            document.getElementById('currentPageBreadcrumb').textContent = pageNames[page];
            
            currentPage = page;
            loadPageData(page);
        }
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('mobile-open');
            } else {
                sidebar.classList.toggle('collapsed');
                mainContent.classList.toggle('expanded');
            }
        }
        
        // Data loading
        async function loadInitialData() {
            await loadDevices();
            await loadStats();
            await loadLogs();
            updateDeviceSelectors();
        }
        
        async function loadPageData(page) {
            switch(page) {
                case 'dashboard':
                    await loadStats();
                    await loadActivity();
                    break;
                case 'devices':
                    await loadDevices();
                    break;
                case 'logs':
                    await loadLogs();
                    break;
                case 'analytics':
                    await loadAnalytics();
                    break;
                case 'automation':
                    await loadAutomationSettings();
                    await loadScheduledMessages();
                    break;
            }
        }
        
        // Device management
        async function loadDevices() {
            try {
                const response = await fetchWithAuth('/api/devices');
                const result = await response.json();
                
                if (result.success) {
                    devices = result.data || [];
                    displayDevices();
                    updateDeviceStats();
                } else {
                    const statusResponse = await fetchWithAuth('/api/info');
                    const statusResult = await statusResponse.json();
                    
                    if (statusResult.success && statusResult.data.connected) {
                        devices = [{
                            id: 'primary',
                            name: 'Primary Device',
                            phone: statusResult.data.jid,
                            status: 'online',
                            platform: 'WhatsApp Web',
                            lastSeen: new Date(),
                            messagesCount: 0,
                            isActive: true
                        }];
                        displayDevices();
                        updateDeviceStats();
                    }
                }
            } catch (error) {
                console.error('Error loading devices:', error);
                showNotification('Failed to load devices', 'error');
            }
        }
        
        function displayDevices() {
            const devicesGrid = document.getElementById('devicesGrid');
            
            if (devices.length === 0) {
                devicesGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <h3>No Devices Connected</h3>
                        <p>Add your first WhatsApp device to get started with multi-device management</p>
                        <button class="btn btn-whatsapp bounce-in" onclick="addNewDevice()" style="margin-top: 15px;">
                            <i class="fas fa-plus"></i> Add Your First Device
                        </button>
                    </div>
                `;
                return;
            }
            
            devicesGrid.innerHTML = devices.map(device => `
                <div class="device-card bounce-in">
                    <div class="device-status ${device.status}"></div>
                    <div class="device-header">
                        <div class="device-avatar">
                            <i class="fab fa-whatsapp"></i>
                        </div>
                        <div style="flex: 1;">
                            <h3>
                                ${device.name}
                                ${device.isActive ? '<span class="active-badge">ACTIVE</span>' : ''}
                            </h3>
                            <div class="device-phone">
                                <i class="fas fa-phone" style="margin-right: 4px;"></i>
                                ${device.phone || 'N/A'}
                            </div>
                        </div>
                    </div>
                    <div class="device-meta">
                        <div class="device-meta-item">
                            <div class="device-meta-label">
                                <i class="fas fa-laptop"></i> Platform
                            </div>
                            <div class="device-meta-value">${device.platform || 'Unknown'}</div>
                        </div>
                        <div class="device-meta-item">
                            <div class="device-meta-label">
                                <i class="fas fa-envelope"></i> Messages
                            </div>
                            <div class="device-meta-value">${device.messagesCount || 0}</div>
                        </div>
                        <div class="device-meta-item">
                            <div class="device-meta-label">
                                <i class="fas fa-signal"></i> Status
                            </div>
                            <div class="device-meta-value" style="color: ${device.status === 'online' ? 'var(--success-color)' : 'var(--danger-color)'};">
                                ${device.status.charAt(0).toUpperCase() + device.status.slice(1)}
                            </div>
                        </div>
                        <div class="device-meta-item">
                            <div class="device-meta-label">
                                <i class="fas fa-clock"></i> Last Seen
                            </div>
                            <div class="device-meta-value">${formatLastSeen(device.lastSeen)}</div>
                        </div>
                    </div>
                    <div class="device-actions">
                        <button class="btn btn-whatsapp" onclick="selectActiveDevice('${device.id}')">
                            <i class="fas fa-check-circle"></i> Set Active
                        </button>
                        <button class="btn btn-success" onclick="testDevice('${device.id}')">
                            <i class="fas fa-vial"></i> Test
                        </button>
                        <button class="btn btn-secondary" onclick="viewDeviceDetails('${device.id}')">
                            <i class="fas fa-eye"></i> Details
                        </button>
                        <button class="btn btn-danger" onclick="disconnectDevice('${device.id}')">
                            <i class="fas fa-plug"></i> Disconnect
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function updateDeviceSelectors() {
            const selectors = ['activeDeviceSelector', 'messageDeviceSelector', 'bulkDeviceSelector'];
            
            selectors.forEach(selectorId => {
                const selector = document.getElementById(selectorId);
                const currentValue = selector.value;
                
                selector.innerHTML = '<option value="">Select Device</option>' +
                    devices.filter(d => d.status === 'online').map(device => 
                        `<option value="${device.id}" ${device.isActive ? 'selected' : ''}>${device.name} (${device.phone})</option>`
                    ).join('');
                
                if (currentValue && selector.querySelector(`option[value="${currentValue}"]`)) {
                    selector.value = currentValue;
                }
            });
        }
        
        // Device actions
        async function addNewDevice() {
            window.open('/pair', '_blank', 'width=500,height=700');
            showNotification('Opening device pairing window...', 'info');
        }
        
        async function selectActiveDevice(deviceId) {
            try {
                const response = await fetchWithAuth('/api/device/activate', {
                    method: 'POST',
                    body: JSON.stringify({ deviceId })
                });
                
                const result = await response.json();
                if (result.success) {
                    devices.forEach(d => d.isActive = d.id === deviceId);
                    displayDevices();
                    updateDeviceSelectors();
                    showNotification(`Device activated: ${devices.find(d => d.id === deviceId)?.name}`, 'success');
                } else {
                    showNotification(result.message || 'Failed to activate device', 'error');
                }
            } catch (error) {
                showNotification('Error activating device', 'error');
            }
        }
        
        async function testDevice(deviceId) {
            try {
                showNotification('Testing device connection...', 'info');
                
                const response = await fetchWithAuth('/api/device/test', {
                    method: 'POST',
                    body: JSON.stringify({ deviceId })
                });
                
                const result = await response.json();
                if (result.success) {
                    showNotification('Device test successful!', 'success');
                } else {
                    showNotification(result.message || 'Device test failed', 'error');
                }
            } catch (error) {
                showNotification('Error testing device', 'error');
            }
        }
        
        async function disconnectDevice(deviceId) {
            if (!confirm('Are you sure you want to disconnect this device?')) return;
            
            try {
                const response = await fetchWithAuth('/api/device/disconnect', {
                    method: 'POST',
                    body: JSON.stringify({ deviceId })
                });
                
                const result = await response.json();
                if (result.success) {
                    loadDevices();
                    showNotification('Device disconnected successfully', 'success');
                } else {
                    showNotification(result.message || 'Failed to disconnect device', 'error');
                }
            } catch (error) {
                showNotification('Error disconnecting device', 'error');
            }
        }
        
        function viewDeviceDetails(deviceId) {
            const device = devices.find(d => d.id === deviceId);
            if (!device) return;
            
            const details = `
Device Information:

Name: ${device.name}
Phone: ${device.phone}
Status: ${device.status}
Platform: ${device.platform}
Messages: ${device.messagesCount}
Last Seen: ${formatLastSeen(device.lastSeen)}
Active: ${device.isActive ? 'Yes' : 'No'}
            `;
            alert(details);
        }
        
        // Statistics
        async function loadStats() {
            try {
                const response = await fetchWithAuth('/api/stats');
                const result = await response.json();
                
                if (result.success) {
                    updateDashboardStats(result.data);
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }
        
        function updateDashboardStats(stats) {
            document.getElementById('connectedDevicesCount').textContent = devices.filter(d => d.status === 'online').length;
            document.getElementById('messagesToday').textContent = stats.daily_counts?.[new Date().toISOString().split('T')[0]] || 0;
            document.getElementById('totalSent').textContent = stats.total_sent || 0;
            document.getElementById('totalReceived').textContent = stats.total_received || 0;
            document.getElementById('totalFailed').textContent = stats.total_failed || 0;
            
            const total = (stats.total_sent || 0) + (stats.total_failed || 0);
            const successRate = total > 0 ? Math.round((stats.total_sent / total) * 100) : 0;
            document.getElementById('successRate').textContent = successRate + '%';
            
            document.getElementById('activeAutomations').textContent = stats.active_automations || 0;
        }
        
        function updateDeviceStats() {
            const onlineDevices = devices.filter(d => d.status === 'online').length;
            document.getElementById('connectedDevicesCount').textContent = onlineDevices;
            document.getElementById('activeConnections').textContent = onlineDevices;
        }
        
        // Activity feed
        async function loadActivity() {
            try {
                const response = await fetchWithAuth('/api/logs');
                const result = await response.json();
                
                if (result.success && result.data) {
                    displayActivity(result.data.slice(0, 10));
                }
            } catch (error) {
                console.error('Error loading activity:', error);
            }
        }
        
        function displayActivity(logs) {
            const activityList = document.getElementById('activityList');
            
            if (!logs || logs.length === 0) {
                activityList.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">
                            <i class="fas fa-inbox"></i>
                        </div>
                        <h3>No Recent Activity</h3>
                        <p>Activity will appear here when devices are connected</p>
                    </div>
                `;
                return;
            }
            
            activityList.innerHTML = logs.map(log => {
                const activityType = getActivityType(log);
                return `
                    <div class="activity-item">
                        <div class="activity-icon ${activityType.class}">
                            <i class="${activityType.icon}"></i>
                        </div>
                        <div class="activity-content">
                            <h4>${activityType.title}</h4>
                            <p>${log}</p>
                        </div>
                        <div class="activity-time">${getRelativeTime()}</div>
                    </div>
                `;
            }).join('');
        }
        
        function getActivityType(log) {
            if (log.includes('') || log.includes('success') || log.includes('sent')) {
                return { icon: 'fas fa-check-circle', class: 'success', title: 'Success' };
            } else if (log.includes('') || log.includes('failed') || log.includes('error')) {
                return { icon: 'fas fa-times-circle', class: 'error', title: 'Error' };
            } else if (log.includes('') || log.includes('warning')) {
                return { icon: 'fas fa-exclamation-triangle', class: 'warning', title: 'Warning' };
            } else {
                return { icon: 'fas fa-info-circle', class: 'info', title: 'Info' };
            }
        }
        
        // Messaging
        async function sendQuickMessage() {
            const deviceId = document.getElementById('messageDeviceSelector').value;
            const phone = document.getElementById('quickPhone').value.trim();
            const message = document.getElementById('quickMessage').value.trim();
            
            if (!deviceId) {
                showNotification('Please select a device', 'warning');
                return;
            }
            
            if (!phone || !message) {
                showNotification('Phone number and message are required', 'warning');
                return;
            }
            
            try {
                showNotification('Sending message...', 'info');
                
                const response = await fetchWithAuth(`/send?phone=${encodeURIComponent(phone)}&text=${encodeURIComponent(message)}&device=${deviceId}`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Message sent successfully!', 'success');
                    document.getElementById('quickPhone').value = '';
                    document.getElementById('quickMessage').value = '';
                    loadStats();
                } else {
                    showNotification(result.message || 'Failed to send message', 'error');
                }
            } catch (error) {
                showNotification('Error sending message: ' + error.message, 'error');
            }
        }
        
        // Bulk messaging
        async function sendBulkMessage() {
            const deviceId = document.getElementById('bulkDeviceSelector').value;
            const numbers = document.getElementById('bulkNumbers').value.trim().split('\n').filter(n => n.trim());
            const message = document.getElementById('bulkMessage').value.trim();
            const delay = parseInt(document.getElementById('bulkDelay').value) || 5;
            
            if (!deviceId) {
                showNotification('Please select a device', 'warning');
                return;
            }
            
            if (numbers.length === 0 || !message) {
                showNotification('Numbers and message are required', 'warning');
                return;
            }
            
            if (!confirm(`Send message to ${numbers.length} numbers with ${delay}s delay?`)) return;
            
            try {
                document.getElementById('bulkProgress').style.display = 'block';
                showNotification(`Starting bulk send to ${numbers.length} numbers...`, 'info');
                
                for (let i = 0; i < numbers.length; i++) {
                    const phone = numbers[i].trim();
                    
                    try {
                        await fetchWithAuth(`/send?phone=${encodeURIComponent(phone)}&text=${encodeURIComponent(message)}&device=${deviceId}`, {
                            method: 'POST'
                        });
                        
                        const progress = Math.round(((i + 1) / numbers.length) * 100);
                        document.getElementById('progressBar').style.width = progress + '%';
                        document.getElementById('progressText').textContent = `${i + 1} / ${numbers.length} sent`;
                        
                        if (i < numbers.length - 1) {
                            await new Promise(resolve => setTimeout(resolve, delay * 1000));
                        }
                    } catch (error) {
                        console.error(`Failed to send to ${phone}:`, error);
                    }
                }
                
                showNotification('Bulk messaging completed!', 'success');
                document.getElementById('bulkNumbers').value = '';
                document.getElementById('bulkMessage').value = '';
                
                setTimeout(() => {
                    document.getElementById('bulkProgress').style.display = 'none';
                    document.getElementById('progressBar').style.width = '0%';
                }, 3000);
                
            } catch (error) {
                showNotification('Error during bulk send: ' + error.message, 'error');
            }
        }
        
        function handleCSVUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                const lines = content.split('\n').filter(line => line.trim());
                const numbers = lines.map(line => line.split(',')[0].trim()).filter(n => n);
                
                document.getElementById('bulkNumbers').value = numbers.join('\n');
                showNotification(`Loaded ${numbers.length} numbers from CSV`, 'success');
            };
            reader.readAsText(file);
        }
        
        // Templates
        async function addTemplate() {
            const name = document.getElementById('templateName').value.trim();
            const content = document.getElementById('templateContent').value.trim();
            
            if (!name || !content) {
                showNotification('Template name and content are required', 'warning');
                return;
            }
            
            try {
                const response = await fetchWithAuth('/api/templates', {
                    method: 'POST',
                    body: JSON.stringify({ name, content })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Template added successfully!', 'success');
                    document.getElementById('templateName').value = '';
                    document.getElementById('templateContent').value = '';
                    loadTemplates();
                } else {
                    showNotification(result.message || 'Failed to add template', 'error');
                }
            } catch (error) {
                showNotification('Error adding template', 'error');
            }
        }
        
        // Automation
        async function saveAutomationSettings() {
            const autoReplyEnabled = document.getElementById('autoReplyEnabled').checked;
            const autoReplyText = document.getElementById('autoReplyText').value.trim();
            const autoReplyDelay = parseInt(document.getElementById('autoReplyDelay').value) || 3;
            
            try {
                const response = await fetchWithAuth('/api/config', {
                    method: 'POST',
                    body: JSON.stringify({
                        reply_enable: autoReplyEnabled,
                        reply_text: autoReplyText,
                        auto_reply_delay: autoReplyDelay
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Automation settings saved!', 'success');
                } else {
                    showNotification(result.message || 'Failed to save settings', 'error');
                }
            } catch (error) {
                showNotification('Error saving settings', 'error');
            }
        }
        
        async function loadAutomationSettings() {
            try {
                const response = await fetchWithAuth('/api/config');
                const result = await response.json();
                
                if (result.success && result.data) {
                    document.getElementById('autoReplyEnabled').checked = result.data.reply_enable || false;
                    document.getElementById('autoReplyText').value = result.data.reply_text || '';
                    document.getElementById('autoReplyDelay').value = result.data.auto_reply_delay || 3;
                }
            } catch (error) {
                console.error('Error loading automation settings:', error);
            }
        }
        
        async function scheduleMessage() {
            const phone = document.getElementById('schedulePhone').value.trim();
            const message = document.getElementById('scheduleMessage').value.trim();
            const datetime = document.getElementById('scheduleDateTime').value;
            
            if (!phone || !message || !datetime) {
                showNotification('All fields are required for scheduling', 'warning');
                return;
            }
            
            try {
                const response = await fetchWithAuth('/api/schedule', {
                    method: 'POST',
                    body: JSON.stringify({ phone, message, scheduled_at: datetime })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Message scheduled successfully!', 'success');
                    document.getElementById('schedulePhone').value = '';
                    document.getElementById('scheduleMessage').value = '';
                    document.getElementById('scheduleDateTime').value = '';
                    loadScheduledMessages();
                } else {
                    showNotification(result.message || 'Failed to schedule message', 'error');
                }
            } catch (error) {
                showNotification('Error scheduling message', 'error');
            }
        }
        
        async function loadScheduledMessages() {
            // Implementation for loading scheduled messages
        }
        
        // Logs
        async function loadLogs() {
            try {
                const response = await fetchWithAuth('/api/logs');
                const result = await response.json();
                
                if (result.success && result.data) {
                    displayLogs(result.data);
                }
            } catch (error) {
                console.error('Error loading logs:', error);
            }
        }
        
        function displayLogs(logs) {
            const logEntries = document.getElementById('logEntries');
            
            if (!logs || logs.length ===0) {
                logEntries.innerHTML = '<div style="color: #7d8590;">[SYSTEM] No log entries available</div>';
                return;
            }
            
            logEntries.innerHTML = logs.map(log => {
                const timestamp = new Date().toLocaleTimeString();
                let level = 'info';
                let color = '#e6edf3';
                
                if (log.includes('ERROR') || log.includes('')) {
                    level = 'error';
                    color = '#f85149';
                } else if (log.includes('WARN') || log.includes('')) {
                    level = 'warn';
                    color = '#f0883e';
                } else if (log.includes('SUCCESS') || log.includes('')) {
                    level = 'success';
                    color = '#3fb950';
                } else if (log.includes('SECURITY') || log.includes('')) {
                    level = 'security';
                    color = '#a5a5f3';
                }
                
                return `
                    <div class="log-entry">
                        <span class="log-timestamp">[${timestamp}]</span>
                        <span class="log-level ${level}">${level.toUpperCase()}</span>
                        <span style="color: ${color};">${escapeHtml(log)}</span>
                    </div>
                `;
            }).join('');
            
            // Auto-scroll to bottom
            const terminal = document.getElementById('terminalLogs');
            terminal.scrollTop = terminal.scrollHeight;
        }
        
        async function refreshLogs() {
            showNotification('Refreshing logs...', 'info');
            await loadLogs();
            showNotification('Logs refreshed', 'success');
        }
        
        async function downloadLogs() {
            try {
                const response = await fetchWithAuth('/api/logs/download');
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `whatsapp-logs-${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                showNotification('Logs downloaded successfully', 'success');
            } catch (error) {
                showNotification('Error downloading logs', 'error');
            }
        }
        
        async function clearLogs() {
            if (!confirm('Are you sure you want to clear all logs?')) return;
            
            try {
                const response = await fetchWithAuth('/api/logs/clear', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Logs cleared successfully', 'success');
                    loadLogs();
                } else {
                    showNotification('Failed to clear logs', 'error');
                }
            } catch (error) {
                showNotification('Error clearing logs', 'error');
            }
        }
        
        // Analytics
        async function loadAnalytics() {
            await loadStats();
        }
        
        async function exportAnalytics() {
            try {
                const response = await fetchWithAuth('/api/analytics/export');
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `whatsapp-analytics-${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                showNotification('Analytics exported successfully', 'success');
            } catch (error) {
                showNotification('Error exporting analytics', 'error');
            }
        }
        
        async function refreshAnalytics() {
            showNotification('Refreshing analytics...', 'info');
            await loadAnalytics();
            showNotification('Analytics refreshed', 'success');
        }
        
        // Settings
        async function saveSettings() {
            const safeMode = document.getElementById('safeMode').checked;
            const dailyLimit = parseInt(document.getElementById('dailyLimit').value) || 100;
            const hourlyLimit = parseInt(document.getElementById('hourlyLimit').value) || 20;
            const minDelay = parseInt(document.getElementById('minDelay').value) || 3;
            
            try {
                const response = await fetchWithAuth('/api/config', {
                    method: 'POST',
                    body: JSON.stringify({
                        safe_mode: safeMode,
                        daily_send_limit: dailyLimit,
                        hourly_send_limit: hourlyLimit,
                        min_send_delay: minDelay
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Settings saved successfully!', 'success');
                } else {
                    showNotification(result.message || 'Failed to save settings', 'error');
                }
            } catch (error) {
                showNotification('Error saving settings', 'error');
            }
        }
        
        async function loadSettings() {
            try {
                const response = await fetchWithAuth('/api/config');
                const result = await response.json();
                
                if (result.success && result.data) {
                    document.getElementById('safeMode').checked = result.data.safe_mode || false;
                    document.getElementById('dailyLimit').value = result.data.daily_send_limit || 100;
                    document.getElementById('hourlyLimit').value = result.data.hourly_send_limit || 20;
                    document.getElementById('minDelay').value = result.data.min_send_delay || 3;
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }
        
        async function downloadBackup() {
            try {
                const response = await fetchWithAuth('/api/backup');
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `whatsapp-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                showNotification('Backup downloaded successfully', 'success');
            } catch (error) {
                showNotification('Error downloading backup', 'error');
            }
        }
        
        async function restoreBackup() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = async function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                if (!confirm('This will restore all settings from the backup. Continue?')) return;
                
                try {
                    const formData = new FormData();
                    formData.append('backup', file);
                    
                    const response = await fetch('/api/restore', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        showNotification('Backup restored successfully', 'success');
                        setTimeout(() => window.location.reload(), 2000);
                    } else {
                        showNotification(result.message || 'Failed to restore backup', 'error');
                    }
                } catch (error) {
                    showNotification('Error restoring backup', 'error');
                }
            };
            input.click();
        }
        
        async function restartSystem() {
            if (!confirm('Are you sure you want to restart the system?')) return;
            
            try {
                const response = await fetchWithAuth('/api/restart', {
                    method: 'POST'
                });
                
                const result = await response.json();
                if (result.success) {
                    showNotification('System is restarting...', 'info');
                    setTimeout(() => window.location.reload(), 5000);
                } else {
                    showNotification('Failed to restart system', 'error');
                }
            } catch (error) {
                showNotification('Error restarting system', 'error');
            }
        }
        
        async function logoutAllDevices() {
            if (!confirm('Are you sure you want to logout all devices? This action cannot be undone.')) return;
            
            try {
                const response = await fetchWithAuth('/logout', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('All devices logged out successfully', 'success');
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                } else {
                    showNotification(result.message || 'Failed to logout devices', 'error');
                }
            } catch (error) {
                showNotification('Error logging out devices', 'error');
            }
        }
        
        async function disconnectAllDevices() {
            if (!confirm('Are you sure you want to disconnect all devices?')) return;
            
            try {
                const response = await fetchWithAuth('/api/devices/disconnect-all', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('All devices disconnected', 'success');
                    loadDevices();
                } else {
                    showNotification('Failed to disconnect all devices', 'error');
                }
            } catch (error) {
                showNotification('Error disconnecting devices', 'error');
            }
        }
        
        // Real-time updates
        function startRealTimeUpdates() {
            refreshInterval = setInterval(async () => {
                if (document.visibilityState === 'visible') {
                    await loadStats();
                    await loadDevices();
                    if (currentPage === 'dashboard') {
                        await loadActivity();
                    }
                }
            }, 15000);
            
            logInterval = setInterval(async () => {
                if (currentPage === 'logs' && document.visibilityState === 'visible') {
                    await loadLogs();
                }
            }, 5000);
            
            setInterval(updateSystemUptime, 1000);
        }
        
        // Dashboard actions
        async function refreshDashboard() {
            showNotification('Refreshing dashboard...', 'info');
            await Promise.all([
                loadStats(),
                loadDevices(),
                loadActivity()
            ]);
            showNotification('Dashboard refreshed', 'success');
        }
        
        function refreshActivity() {
            loadActivity();
            showNotification('Activity refreshed', 'success');
        }
        
        function refreshDevices() {
            loadDevices();
            showNotification('Devices refreshed', 'success');
        }
        
        // Helper functions
        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString();
        }
        
        function updateSystemUptime() {
            const uptimeElement = document.getElementById('systemUptime');
            if (uptimeElement) {
                const uptime = '24h 15m'; // This would be calculated from server start time
                uptimeElement.textContent = uptime;
            }
        }
        
        function formatLastSeen(lastSeen) {
            if (!lastSeen) return 'Unknown';
            const date = new Date(lastSeen);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
            return date.toLocaleDateString();
        }
        
        function getRelativeTime() {
            return 'Just now';
        }
        
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }
        
        async function fetchWithAuth(url, options = {}) {
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    ...options.headers
                },
                ...options
            };
            
            return fetch(url, defaultOptions);
        }
        
        function showNotification(message, type = 'info') {
            const notifications = document.getElementById('notifications');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-times-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };
            
            const colors = {
                success: 'var(--success-color)',
                error: 'var(--danger-color)',
                warning: 'var(--warning-color)',
                info: 'var(--info-color)'
            };
            
            notification.innerHTML = `
                <div class="notification-header">
                    <i class="${icons[type]} notification-icon" style="color: ${colors[type]};"></i>
                    <span class="notification-title">${type.charAt(0).toUpperCase() + type.slice(1)}</span>
                </div>
                <p class="notification-message">${message}</p>
            `;
            
            notifications.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('hide');
                setTimeout(() => {
                    if (notifications.contains(notification)) {
                        notifications.removeChild(notification);
                    }
                }, 400);
            }, 5000);
        }
        
        function handleDeviceChange(e) {
            const deviceId = e.target.value;
            if (deviceId) {
                const device = devices.find(d => d.id === deviceId);
                if (device) {
                    showNotification(`Switched to: ${device.name}`, 'info');
                }
            }
        }
        
        // Templates functionality
        async function loadTemplates() {
            try {
                const response = await fetchWithAuth('/api/config');
                const result = await response.json();
                
                if (result.success && result.data.templates) {
                    displayTemplates(result.data.templates);
                }
            } catch (error) {
                console.error('Error loading templates:', error);
            }
        }
        
        function displayTemplates(templates) {
            const templatesList = document.getElementById('templatesList');
            
            if (!templates || templates.length === 0) {
                templatesList.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">
                            <i class="fas fa-file-plus"></i>
                        </div>
                        <h3>No Templates</h3>
                        <p>Create templates for quick messaging</p>
                    </div>
                `;
                return;
            }
            
            templatesList.innerHTML = templates.map((template, index) => `
                <div style="background: #f8fafc; padding: 15px; border-radius: 12px; margin-bottom: 12px; border: 1px solid #e2e8f0;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <strong style="color: var(--text-primary); font-size: 14px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-file-alt" style="color: var(--whatsapp-primary);"></i>
                            ${template.name}
                        </strong>
                        <div style="display: flex; gap: 6px;">
                            <button class="btn btn-primary" style="padding: 6px 12px; font-size: 11px;" onclick="useTemplate(${index})">
                                <i class="fas fa-copy"></i> Use
                            </button>
                            <button class="btn btn-danger" style="padding: 6px 10px; font-size: 11px;" onclick="deleteTemplate(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <p style="font-size: 12px; color: var(--text-secondary); margin: 0; line-height: 1.4; background: rgba(255,255,255,0.8); padding: 8px; border-radius: 6px;">
                        ${template.content.substring(0, 100)}${template.content.length > 100 ? '...' : ''}
                    </p>
                </div>
            `).join('');
        }
        
        function useTemplate(index) {
            // This would copy the template to the active message field
            showNotification('Template copied to message field', 'success');
        }
        
        async function deleteTemplate(index) {
            if (!confirm('Are you sure you want to delete this template?')) return;
            
            try {
                const response = await fetchWithAuth(`/api/templates/${index}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Template deleted successfully', 'success');
                    loadTemplates();
                } else {
                    showNotification('Failed to delete template', 'error');
                }
            } catch (error) {
                showNotification('Error deleting template', 'error');
            }
        }
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (refreshInterval) clearInterval(refreshInterval);
            if (logInterval) clearInterval(logInterval);
        });
        
        // Load page-specific data on page load
        if (currentPage === 'settings') {
            loadSettings();
        }
        
        if (currentPage === 'automation') {
            loadAutomationSettings();
            loadScheduledMessages();
        }
        
        if (currentPage === 'messaging') {
            loadTemplates();
        }
        
        // Handle window resize
        window.addEventListener('resize', function() {
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('collapsed');
                document.getElementById('mainContent').classList.remove('expanded');
            }
        });
        
        // Handle visibility change for performance optimization
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'visible') {
                // Resume real-time updates when page becomes visible
                if (!refreshInterval) {
                    startRealTimeUpdates();
                }
            }
        });
        
        // Auto-hide mobile sidebar when clicking outside
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768) {
                const sidebar = document.getElementById('sidebar');
                const toggle = document.getElementById('toggleSidebar');
                
                if (!sidebar.contains(event.target) && !toggle.contains(event.target)) {
                    sidebar.classList.remove('mobile-open');
                }
            }
        });
    </script>
</body>
</html>


